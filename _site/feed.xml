<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.1.1">Jekyll</generator><link href="https://thefirstwind.github.io//feed.xml" rel="self" type="application/atom+xml" /><link href="https://thefirstwind.github.io//" rel="alternate" type="text/html" /><updated>2020-11-03T15:43:40+08:00</updated><id>https://thefirstwind.github.io//feed.xml</id><title type="html">kei’s blog</title><subtitle>An amazing website of kei.</subtitle><author><name>kei gosling</name></author><entry><title type="html">订单与结算逻辑 结算与支付</title><link href="https://thefirstwind.github.io//2020-10-03-%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E7%BB%93%E7%AE%97%E4%B8%8E%E6%94%AF%E4%BB%98/" rel="alternate" type="text/html" title="订单与结算逻辑 结算与支付" /><published>2020-10-03T00:00:00+08:00</published><updated>2020-10-03T00:00:00+08:00</updated><id>https://thefirstwind.github.io//%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E7%BB%93%E7%AE%97%E4%B8%8E%E6%94%AF%E4%BB%98</id><content type="html" xml:base="https://thefirstwind.github.io//2020-10-03-%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E7%BB%93%E7%AE%97%E4%B8%8E%E6%94%AF%E4%BB%98/">&lt;h1 id=&quot;01-订单与结算逻辑结算与支付&quot;&gt;01. 订单与结算逻辑.结算与支付&lt;/h1&gt;

&lt;blockquote&gt;

  &lt;ul&gt;
    &lt;li&gt;&lt;strong&gt;时间&lt;/strong&gt;：2018年8月23日&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;@[订单, 结算逻辑]&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;[TOC]&lt;/p&gt;

&lt;h2 id=&quot;数据字典&quot;&gt;数据字典&lt;/h2&gt;

&lt;h3 id=&quot;系统角色&quot;&gt;系统角色&lt;/h3&gt;
&lt;p&gt;| 端  |    用户群体 |    终端类型 | 终端名称  |
| :——– |:——–| :–: |:——–|
| 用户端  |患者、消费者 | 微信公众号 | E护通  |
| 护工端  |院内护工、居家护工 |  微信公众号  | E护通|护工  |
| 护士端  |提供上门服务的在册护士 | 微信公众号/APP  | 护通|专护 |
| POS机端 |擎浩医院管理老师| POS机  |  |
| PC端 |财务、运营、系统管理员等| PC电脑端 |   |
| 统计端|院方高层、护理界高层| 微信公众号  | 擎浩护理  |&lt;/p&gt;

&lt;h3 id=&quot;院内订单类型&quot;&gt;院内订单类型&lt;/h3&gt;
&lt;p&gt;| 订单类型  | 前提条件 |  工资计算说明|
| :——– |:——–| :–: |
| 1对1订单 | 院内有机动护工 | 系统计算、每日按照比例分配 |
| 1对多订单 | 当前病区绑定了护工 |  系统计算、每日按照比例分配   |
| 团队制订单| 当前病区支持团队制 | 不统计报表  |
| 单项订单 |擎浩医院管理老师| 待定 |&lt;/p&gt;

&lt;h3 id=&quot;订单状态&quot;&gt;订单状态&lt;/h3&gt;
&lt;p&gt;| 状态  | 状态名称 |  说明|
| :——– |:——–| :– |
| 0  | 无状态 | 空状态，冗余字段 |
| 1  | 预约中 | 院外抢单用状态 |
| 2  | 预约成功 | POS机管理老师代接单，并且派工之后的状态 |
| 3  | 待支付（在2小时内付款，超时被取消） | 院内订单下单之后的状态 |
| 4  | 已支付（支付成功） | 支付成功的状态 |
| 5  | 待服务（等待上门服务，计时） | 支付成功之后，2个小时之内保持待服务状态 |
| 6  | 服务中（服务进度） | 支付成功之后，2个小时之后进入服务中状态 |
| 7  | 待结算 | 用户(POS机)发起结算 （等待结算并提示用户结算，超时关闭订单）|
| 8  | 已完成 | 用户(POS机)发起结算之后，如果判断退款成功，状态变为完成 |
| 9  | 待评价 | 冗余状态 |
| 10  | 已评价 | 用户评价完成之后 |
| 11  | 已取消（取消成功） | 超时支付，自动变为取消|
| 12  | 申请退款（发起退款申请） | 待服务状态，申请全额退款的状态 |
| 13  | 退款中（退款已受理，并进行退款程序） | 发起退款的状态 |
| 14  | 退款成功 （退款额转入用户账户） | 用户(POS机)发起退款，如果确认退款成功，状态变为退款成功 |
| 15  | 退款失败（提示失败原因） | 用户(POS机)发起退款，如果确认退款失败，状态变为退款失败 |
| 16  | 变更待服务 | 发起订单变更之后的状态 |
| 17  | 结算中 | 用户(POS机)发起结算，状态变为结算中 |
| 18  | 结算完成 | 用户(POS机)发起结算，如果确认结算成功，状态变为结算完成 |
| 19  | 结算失败 | 用户(POS机)发起结算，如果确认结算失败，状态变为结算失败 |&lt;/p&gt;

&lt;h2 id=&quot;数据库设计&quot;&gt;数据库设计&lt;/h2&gt;

&lt;h3 id=&quot;订单主表&quot;&gt;订单主表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：用户下单、POS机下单、发生支付的订单变更
2 修改条件：支付、超时未支付、补录患者信息、订单变更、订单结算（用户或者POS发起的结算）、其他影响状态变化的节点
3 终止条件：超时未支付、订单完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| orduid|String|必须| 订单号|ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| ordid|String|必须| 订单ID|1804050053004W|
| uopid|String|必须| 患者openid| ooDqLwHXcSIFoMZxTX3DtHkLtaOM|
| tradeno|String|必须| 支付UID| TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| ptorduid|String|必须| 患者姓名| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| rlnm|String|必须| 父订单号，续单用，初始值为其本身如果有续单或者纠纷负单则为其父单orduid| 王根娣|
| startday|date|必须| 服务开始时间 默认当前日期| 2018-04-05|
| svcday|Integer|必须| 服务天数| 10|
| statncd|String|必须| 护工站代码| 31010700052|
| statnnm|String|必须| 护工站| 上海市同济大学附属同济医院(同济医院)|
| amount|Integer|必须| 订单初始预收金额| 90000|
| ordlessfee|Integer|| 订单剩余金额| 0|
| status1|Integer|| 0 无状态  &lt;br /&gt;1 预约中 &lt;br /&gt;2 预约成功 &lt;br /&gt;3 待支付（在2小时内付款，超时被取消） &lt;br /&gt;4 已支付（支付成功）&lt;br /&gt;5 待服务（等待上门服务，计时）&lt;br /&gt;6 服务中（服务进度）&lt;br /&gt;7 待结算（等待结算并提示用户结算，超时关闭订单）&lt;br /&gt;8 已完成 &lt;br /&gt;9 待评价 &lt;br /&gt;10 已评价&lt;br /&gt; 11 已取消（取消成功） &lt;br /&gt;12 申请退款（发起退款申请） &lt;br /&gt;13 退款中（退款已受理，并进行退款程序） &lt;br /&gt;14 退款成功 （退款额转入用户账户） &lt;br /&gt;15 退款失败（提示失败原因） &lt;br /&gt;16 变更待服务 &lt;br /&gt;17 结算中 &lt;br /&gt;18 结算完成 &lt;br /&gt;19结算失败 &lt;br /&gt;| 5|
| status1nm|String|| 同上| 待服务|
| usrconftm|datetime||用户确认完成时间| 2018-04-14 14:54:50|
| splitsttlfg|Integer|| 拆分结算标识0：未拆分结算，1已拆分结算| 0|
| continufee|Integer|| 结转金额| 0|
| chgstatus|Integer||  1 变更未开始 &lt;br /&gt;2 变更已开始&lt;br /&gt;| 0|
| sttlefg|Integer|| 结算标识：给用户退款订单结算掉，成功结算更新 0默认,1已结算| 0|&lt;/p&gt;

&lt;h3 id=&quot;订单详情表&quot;&gt;订单详情表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：用户下单、POS机下单、不发生支付的订单变更
2 修改条件：订单变更、订单结算（用户或POS发起的订单结算）、护工结束服务、其他影响状态变化的节点
3 终止条件：超时未支付、订单完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| orduid|String|必须| 订单号|ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| wuid|String|必须| 护工Uid| WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh|
| wstatncd|String|必须| 所属网点 该护工所属网点|31010700052 |
| statncd|String|必须|服务网点 订单服务网点（非网点，没有代码） |31010700052 |
| hospnm|String|必须| 服务医院 医院名称| 上海市同济大学附属同济医院(同济医院)|
| sitmid|Integer|必须| 服务项目 当ordtp属于院内时| |
| svctp|String|必须| 交易号| TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| startday|date|必须| 服务开始时间 默认当前日期| 2018-04-05|
| svcday|Integer|必须| 服务天数| 10|
| unitprice|Integer|必须|  服务项目单价| 9000|
| amount|Integer|必须| 服务项目小计 服务项目单价 X 服务天数（精算）| 90000|
| adjustday|decimal(4,2)|| 调整天数 -0.5 0  0.5 三个值，在最后一天结算| 0|
| status1|Integer|| 0 无状态&lt;br /&gt;1 预约中 &lt;br /&gt;2 预约成功&lt;br /&gt;3 待支付（在15分钟内付款，超时被取消） &lt;br /&gt;4 已支付（支付成功）.&lt;br /&gt;5 待服务（等待上门服务，计时）&lt;br /&gt;6 服务中（服务进度）&lt;br /&gt;7 待结算（等待结算并提示用户结算，超时关闭订单）&lt;br /&gt;8 已完成&lt;br /&gt;9 待评价 &lt;br /&gt;10 已评价&lt;br /&gt;11 已取消（取消成功） &lt;br /&gt;12 申请退款（发起退款申请） &lt;br /&gt;13 退款中（退款已受理，并进行退款程序） &lt;br /&gt;14 退款成功 （退款额转入用户账户） &lt;br /&gt;15 退款失败（提示失败原因）&lt;br /&gt;16 变更待服务&lt;br /&gt;17 结算中 &lt;br /&gt;18 结算完成 &lt;br /&gt;19结算失败 | 5|
| status1nm|String||同上 | 待服务|
| status3|Integer|| 状态-完成 0 无状态 1 完成 | 1|
| status3nm|String|| 状态-完成-说明 保存护工的做工状态 | 完成|
| factsvcfg|Integer|| 子单实际服务标识：0 是默认，1 是结算退款记录， 2 是退款记录{tips:该子单是否是实际服务单} | 0|&lt;/p&gt;

&lt;h3 id=&quot;支付信息表&quot;&gt;支付信息表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：支付、退款、结算等，有金额流转的情况
2 修改条件：支付成功后状态 paid状态更新，结算申请发起、结算状态更新、退款状态发起、退款状态更新。
3 终止条件：超时未支付、支付完成、结算完成、退款完成、
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| tradeno|String|必须| 支付订单号 tr+”-“+36位UUID（带-）&lt;br /&gt;微信线上支付 pt开头&lt;br /&gt;微信扫码支付 td开头&lt;br /&gt;银联支付 tr开头|TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| orduid|String|必须| 订单UID 订单主表ID| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| uopid|String|| 用户UID 支付者UID，不一定是被服务的患者|ooDqLwHXcSIFoMZxTX3DtHkLtaOM|
| fopid|String|| 推荐者UID 推荐者UID||
| ttype|Integer|| 订单类型 1医院 2医院单项 3居家|1|
| paid|Integer|| 是否已支付 &lt;br /&gt;0 未支付 &lt;br /&gt;1 线上支付 &lt;br /&gt;2 现金支付&lt;br /&gt;3 退款成功&lt;br /&gt;4 退款失败|1|
| paidtm|datetime|| 支付时间 非0的时候 才有值|2018-04-05 10:58:56|
| payment|Integer|| 支付方式 &lt;br /&gt;1 微信 &lt;br /&gt;2 刷卡（借记卡） &lt;br /&gt;3 刷卡（信用卡） &lt;br /&gt;4 现金（线下支付）&lt;br /&gt; 5 支付宝|1|
| amount|Integer|| 支付金额|90000|
| outorderno|String|| 外部订单号 外部订单号||
| outtransno|String|| 外部流水号 外部流水号|4200000095201804052560224795|
| resttlfg|Integer|| 预结算标志位：0未结算，1已结算||
| sttlfg|Integer|| 已结算标志 0未结算 1 已结算||
| sttlamt|Integer|| 结算金额||
| invoicetm|datetime|| 预分账标志位||
| reinvfg|Integer|| 分账标志||
| invoicefg|Integer|| ||
| refund|Integer|| 退款标志 现阶段价格统一。&lt;br /&gt;该字段为空，当每个省价格不同时，会用到。&lt;br /&gt;0是付款 1是退款|0|
| cardNo|String|| 银联支付用字段: 支付时所用的卡号(该字段当银联支付退款时使用)||
| transChnName|String|| 支付渠道名称||
| transEngName|String|| 支付渠道||
| refNo|String|| 银联支付用参考号||
| merchantNo|String|| 根据支付时的，商户编号||
| terminalNo|String|| pos机终端号码||
| traceNo|String|| 银联商务支付的记录号(每一个pos机从1开始计数)||&lt;/p&gt;

&lt;h3 id=&quot;日结表&quot;&gt;日结表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：开始服务的订单，每日12:30/23:30 进行结算
2 修改条件：无
3 终止条件：预付款消耗完为止
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| daysttuid|String|必须| 日结算UID|DST_VwACGXWSvbwTfEm9I_6dPyvWKkw2|
| orduid|String|必须| 订单UID 订单主表ID| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| porduid|String|必须| 母单orduid| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| sttdate|date|必须| 结算日期| 2018-04-05|
| wuid|String|必须| 护工wuid|WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh|
| daysttfee|Integer|| 日结算金额|9000|
| lessordfee|Integer|| 订单剩余金额(结余金额)|81000|
| daystttm|datetime|| 结算时间|2018-04-09 23:30:00|
| unitprice|Integer|| 单价 | 9000 |
| statncd|String|| 做单护工站 | 31010700052 |
| plusfee|String|| 增收 | 450 |
| wrkfee|String|| 护工工资 | 5400 |
| hospfee|String|| 医院管理费 | 900 |
| companyfee|String|| 管理费（公司管理费:statncd=wstatncd的时候该字段和服务项目单价拆分的公司管理费一致，如果statncd&amp;lt;&amp;gt;wstatncd三七开的订单，则此字段记录总利润 即=sttamount - wrkfee - recomfee） | 2033 |
| platamount|String|| 平台费用 | 0 |
| deptfee|String|| 科室费 | 100 |
| insuranfee|String|| 保险费 | 0 |
| recomfee|String|| 推荐有奖金额 | 0 |
| platformfee|String|| 护工点击结束后用户遗留平台金额 | 0 |
| payfee|String|| 支付金额 | 90000 |
| usrnewordfee|String|| 用户续单结转 | 0 |
| refundfee|String|| 退款金额 | 0 |&lt;/p&gt;

&lt;h3 id=&quot;结算表&quot;&gt;结算表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：结算完成
2 修改条件：无
3 终止条件：结算完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;字段名&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数类型&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;必须&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数说明&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参考值&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sttuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;日结算UID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ST_o9wTyvpiSuSqmbjsMonkilWvm7qXz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;orduid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;订单UID 订单主表ID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;subid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;订单Subid, 子单号&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;statncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;需求方所在护工站，如果院外非网点或居家为空&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wstatncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工所在护工站&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工wuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sttamount&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;结算金额(合算=医院管理费+护工工资+毛利润)&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;90000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unitprice&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;单价 护工身价*系数（目前100%）+保险&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;svcday&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;服务天数&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;plusfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;增收&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4500&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工工资&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;54000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;hospfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;医院管理费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;companyfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;管理费（公司管理费:statncd=wstatncd的时候该字段和服务项目单价拆分的公司管理费一致，如果statncd&amp;lt;&amp;gt;wstatncd三七开的订单，则此字段记录总利润 即=sttamount - wrkfee - recomfee）&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;21383&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platamount&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;平台费用&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;deptfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;科室费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;insuranfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;保险费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;recomfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;推荐有奖金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platformfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工点击结束后用户遗留平台金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;payfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;支付金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;90000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;usrnewordfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;用户续单结转&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;invoicefg&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;分账标识0未分账，1已分账 针对是否分账到qo_ord_fin_statn_invoice表而标识&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;isdowrkfeefg&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工工资标识&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;护工站分账明细&quot;&gt;护工站分账明细&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：结算完成
2 修改条件：无
3 终止条件：结算完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;字段名&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数类型&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;必须&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数说明&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参考值&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;finuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;利益分账UID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FI_5NN3QewfIAJPKvTANe2xwG8nPFmUM&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sttuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;日结算UID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ST_o9wTyvpiSuSqmbjsMonkilWvm7qXz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;orduid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;订单UID 订单主表ID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;requirstatncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;发单方statncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;requirfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;发单方收益&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkstatncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;派单方statncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkstatnfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;派单方收益&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工工资&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;54000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;hospfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;医院管理费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;recomfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;推荐有奖金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;insurfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;保险费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;plusfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;增收&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;suplid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;加盟商cd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;suplfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;发单方加盟商收益&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;21383&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platfeee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;平台遗留金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platamount&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;平台费用&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;护工工资表&quot;&gt;护工工资表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：护工点击完成服务，+15天之后分账
2 修改条件：无
3 终止条件：护工点击完成服务，+15天之后分账
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| wiuid|String|必须| 收入UIDWI开头32位UUID|WI_DxhX4TG2DPkqMyCLLETeUoa4nbtJ0|
| wuid|String|必须| 护工编号UIDWK开头32位UUID|WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh|
| witp|Integer|必须| 收入类型收入类型 1 订单 2 推荐分享 3 奖励 4 积分换取 |1|
| income|Integer|必须| 收入单位是分 |54000|
| status|Integer|必须| 状态&lt;br /&gt;0 订单服务中 &lt;br /&gt;1 等待结算  &lt;br /&gt;2 系统审核中 &lt;br /&gt;9已生效&lt;br /&gt; (订单服务中状态为0，&lt;br /&gt;订单服务截止之间到但未被结算状态为1,&lt;br /&gt;订单被投诉 状态为2，&lt;br /&gt;订单结束并结算再加14天 状态为9，) |2|
| cashed|Integer|必须| 是否已提现0 未体现 1 已提现 |1|
| cashtm|DateTime|必须| 提现时间提现的时间 |2018-04-09 23:30:00|&lt;/p&gt;

&lt;h2 id=&quot;订单状态变化与结算数据的流程&quot;&gt;订单状态变化与结算数据的流程&lt;/h2&gt;
&lt;h3 id=&quot;订单状态变化时序图&quot;&gt;订单状态变化(时序图):&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-sequence&quot;&gt;用户端-&amp;gt;[数据库]: 1 用户自主下单(院外订单)
用户端-&amp;gt;[数据库]: 2 用户自主下单(院内订单)
POS机-&amp;gt;[数据库]: POS机管理老师接单、并且派工
[批处理]-&amp;gt;[数据库]: 2小时无人反映，取消订单
用户端-&amp;gt;[数据库]: [￥支付 微信 ]
POS机-&amp;gt;[数据库]: [￥收款：微信/支付宝/银行卡/现金]
[批处理]-&amp;gt;[批处理]: 30分钟内不支付，支付状态超时
[批处理]--&amp;gt;[数据库]: 取消订单
[批处理]-&amp;gt;[批处理]: 支付成功之后，2小时内处于待服务状态，超过2小时进入服务中
[批处理]--&amp;gt;[数据库]: 待服务-&amp;gt;服务中
[数据库]--&amp;gt;用户端: 查看订单信息
[数据库]-&amp;gt;PC端: 查看订单信息
[数据库]-&amp;gt;护工端: 查看订单信息
护工端--&amp;gt;用户端: 推送服务日志
用户端-&amp;gt;[数据库]: 发起结算
[批处理]--&amp;gt;[批处理]: 发起结算、向银行请求数据、进入结算中状态
[批处理]--&amp;gt;[批处理]: 判断结算申请的结果、
[批处理]--&amp;gt;[数据库]: 结算成功/结算失败 -&amp;gt; 更新状态
[数据库]-&amp;gt;[数据库]: 服务结束时间判断
用户端--&amp;gt;护工端: 订单结算
护工端--&amp;gt;[数据库]: 服务结算
POS机--&amp;gt;用户端: 订单强制结算
POS机--&amp;gt;护工端: 订单强制结算
用户端-&amp;gt;[数据库]:用户评价、状态进入已评价状态
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;后台批处理接口说明&quot;&gt;后台批处理接口说明&lt;/h2&gt;

&lt;h3 id=&quot;01-支付超时的处理&quot;&gt;01. 支付超时的处理&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderCancelUnpaid&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 清理超过2小时的订单未支付的订单
 2 订单变更的处理，当2个小时内不支付，已经申请变更的订单自动变成过期未支付状态
 3 每天 8-20点之间，每分钟执行&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;02-订单变更审核超时的处理&quot;&gt;02. 订单变更审核超时的处理&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/cancelUnaplyToUnPayOrd&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 次日生效 24小时后 不审批 取消并且退款
 2 当日及时生效 6小时后 遍生效 取消并且退款&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;03-订单变更待服务的处理&quot;&gt;03. 订单变更待服务的处理&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderChangeSerStart&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 修改变更服务变成待服务(立即执行) 没有支付的订单变更
 2 只有审批通过的变更待服务才能进入服务状态，否者停留在永远待服务的状态
 3 每分钟执行&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;04-退款给用户的处理微信&quot;&gt;04. 退款给用户的处理（微信）&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderRefundToUser&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 判断订单状态为7，立即退款给用户
 2 每分钟执行&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;05-退款给用户的处理银联&quot;&gt;05. 退款给用户的处理（银联）&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/doRefundToUserUpay&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 判断订单状态为7，立即退款给用户
 2 每分钟执行&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;06-待服务进入服务中无需支付&quot;&gt;06. 待服务进入服务中(无需支付)&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderWaitSerToSer&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 订单支付成功2小时后，待服务进入服务中
 2 每分钟执行，订单支付时间到当前时间有2小时的订单&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;07-变更待服务进入服务中有支付&quot;&gt;07. 变更待服务进入服务中(有支付)&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderChangeWaitSerToSer&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 变更订单的等待状态变成开始服务 有支付状态的订单变更
 2 只有审批通过的变更待服务才能进入服务状态，否者停留在永远待服务的状态
 3 每分钟执行，订单支付时间到当前时间有2小时的订单&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;08-订单拆分&quot;&gt;08. 订单拆分&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/finSplitSttle&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 针对每个订单的拆分细则，拆分 护工工资、平台费、科室费、保险费、公司所得等费用&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;09-分账给护工站&quot;&gt;09. 分账给护工站&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/finInvoiceToStatn&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 针对每个订单的拆分细则，拆分 护工工资、平台费、科室费、保险费、公司所得等费用到具体的护工站&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;10-日结脚本&quot;&gt;10. 日结脚本&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/ordDayStt&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 针对每个订单做当日结算，消耗当天费用，并且拆分 护工工资、平台费、科室费、保险费、公司所得等费用
 2 每天12:30 23:30 跑该脚本&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;11-护工工资结算改变状态脚本&quot;&gt;11. 护工工资结算改变状态脚本&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/doSettleWrkfee&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 根据日结结果，计算每日护工工资
 2 每天1点15分 跑该脚本&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;12-订单逾期脚本&quot;&gt;12. 订单逾期脚本&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/ordFinishStt&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 结算到期订单用户未点击的订单 ，结算成逾期，并且释放床位
 2 每天1点30分 跑该脚本&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;13-订单结算状态脚本&quot;&gt;13. 订单结算状态脚本&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/doSttlement&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 对于用户已经点击结算，护工已经点击结束服务的订单，跑的脚本
 2 分钟跑该脚本&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name>kei gosling</name></author><summary type="html">01. 订单与结算逻辑.结算与支付</summary></entry><entry><title type="html">订单与结算逻辑 后台batch</title><link href="https://thefirstwind.github.io//2020-10-03-%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E5%90%8E%E5%8F%B0batch/" rel="alternate" type="text/html" title="订单与结算逻辑 后台batch" /><published>2020-10-03T00:00:00+08:00</published><updated>2020-10-03T00:00:00+08:00</updated><id>https://thefirstwind.github.io//%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E5%90%8E%E5%8F%B0batch</id><content type="html" xml:base="https://thefirstwind.github.io//2020-10-03-%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E5%90%8E%E5%8F%B0batch/">&lt;h1 id=&quot;01-订单与结算逻辑结算与支付&quot;&gt;01. 订单与结算逻辑.结算与支付&lt;/h1&gt;

&lt;blockquote&gt;

  &lt;ul&gt;
    &lt;li&gt;&lt;strong&gt;时间&lt;/strong&gt;：2018年8月23日&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;@[订单, 结算逻辑]&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;[TOC]&lt;/p&gt;

&lt;h2 id=&quot;数据字典&quot;&gt;数据字典&lt;/h2&gt;

&lt;h3 id=&quot;系统角色&quot;&gt;系统角色&lt;/h3&gt;
&lt;p&gt;| 端  |    用户群体 |    终端类型 | 终端名称  |
| :——– |:——–| :–: |:——–|
| 用户端  |患者、消费者 | 微信公众号 | E护通  |
| 护工端  |院内护工、居家护工 |  微信公众号  | E护通|护工  |
| 护士端  |提供上门服务的在册护士 | 微信公众号/APP  | 护通|专护 |
| POS机端 |擎浩医院管理老师| POS机  |  |
| PC端 |财务、运营、系统管理员等| PC电脑端 |   |
| 统计端|院方高层、护理界高层| 微信公众号  | 擎浩护理  |&lt;/p&gt;

&lt;h3 id=&quot;院内订单类型&quot;&gt;院内订单类型&lt;/h3&gt;
&lt;p&gt;| 订单类型  | 前提条件 |  工资计算说明|
| :——– |:——–| :–: |
| 1对1订单 | 院内有机动护工 | 系统计算、每日按照比例分配 |
| 1对多订单 | 当前病区绑定了护工 |  系统计算、每日按照比例分配   |
| 团队制订单| 当前病区支持团队制 | 不统计报表  |
| 单项订单 |擎浩医院管理老师| 待定 |&lt;/p&gt;

&lt;h3 id=&quot;订单状态&quot;&gt;订单状态&lt;/h3&gt;
&lt;p&gt;| 状态  | 状态名称 |  说明|
| :——– |:——–| :– |
| 0  | 无状态 | 空状态，冗余字段 |
| 1  | 预约中 | 院外抢单用状态 |
| 2  | 预约成功 | POS机管理老师代接单，并且派工之后的状态 |
| 3  | 待支付（在2小时内付款，超时被取消） | 院内订单下单之后的状态 |
| 4  | 已支付（支付成功） | 支付成功的状态 |
| 5  | 待服务（等待上门服务，计时） | 支付成功之后，2个小时之内保持待服务状态 |
| 6  | 服务中（服务进度） | 支付成功之后，2个小时之后进入服务中状态 |
| 7  | 待结算 | 用户(POS机)发起结算 （等待结算并提示用户结算，超时关闭订单）|
| 8  | 已完成 | 用户(POS机)发起结算之后，如果判断退款成功，状态变为完成 |
| 9  | 待评价 | 冗余状态 |
| 10  | 已评价 | 用户评价完成之后 |
| 11  | 已取消（取消成功） | 超时支付，自动变为取消|
| 12  | 申请退款（发起退款申请） | 待服务状态，申请全额退款的状态 |
| 13  | 退款中（退款已受理，并进行退款程序） | 发起退款的状态 |
| 14  | 退款成功 （退款额转入用户账户） | 用户(POS机)发起退款，如果确认退款成功，状态变为退款成功 |
| 15  | 退款失败（提示失败原因） | 用户(POS机)发起退款，如果确认退款失败，状态变为退款失败 |
| 16  | 变更待服务 | 发起订单变更之后的状态 |
| 17  | 结算中 | 用户(POS机)发起结算，状态变为结算中 |
| 18  | 结算完成 | 用户(POS机)发起结算，如果确认结算成功，状态变为结算完成 |
| 19  | 结算失败 | 用户(POS机)发起结算，如果确认结算失败，状态变为结算失败 |&lt;/p&gt;

&lt;h2 id=&quot;数据库设计&quot;&gt;数据库设计&lt;/h2&gt;

&lt;h3 id=&quot;订单主表&quot;&gt;订单主表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：用户下单、POS机下单、发生支付的订单变更
2 修改条件：支付、超时未支付、补录患者信息、订单变更、订单结算（用户或者POS发起的结算）、其他影响状态变化的节点
3 终止条件：超时未支付、订单完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| orduid|String|必须| 订单号|ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| ordid|String|必须| 订单ID|1804050053004W|
| uopid|String|必须| 患者openid| ooDqLwHXcSIFoMZxTX3DtHkLtaOM|
| tradeno|String|必须| 支付UID| TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| ptorduid|String|必须| 患者姓名| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| rlnm|String|必须| 父订单号，续单用，初始值为其本身如果有续单或者纠纷负单则为其父单orduid| 王根娣|
| startday|date|必须| 服务开始时间 默认当前日期| 2018-04-05|
| svcday|Integer|必须| 服务天数| 10|
| statncd|String|必须| 护工站代码| 31010700052|
| statnnm|String|必须| 护工站| 上海市同济大学附属同济医院(同济医院)|
| amount|Integer|必须| 订单初始预收金额| 90000|
| ordlessfee|Integer|| 订单剩余金额| 0|
| status1|Integer|| 0 无状态  &lt;br /&gt;1 预约中 &lt;br /&gt;2 预约成功 &lt;br /&gt;3 待支付（在2小时内付款，超时被取消） &lt;br /&gt;4 已支付（支付成功）&lt;br /&gt;5 待服务（等待上门服务，计时）&lt;br /&gt;6 服务中（服务进度）&lt;br /&gt;7 待结算（等待结算并提示用户结算，超时关闭订单）&lt;br /&gt;8 已完成 &lt;br /&gt;9 待评价 &lt;br /&gt;10 已评价&lt;br /&gt; 11 已取消（取消成功） &lt;br /&gt;12 申请退款（发起退款申请） &lt;br /&gt;13 退款中（退款已受理，并进行退款程序） &lt;br /&gt;14 退款成功 （退款额转入用户账户） &lt;br /&gt;15 退款失败（提示失败原因） &lt;br /&gt;16 变更待服务 &lt;br /&gt;17 结算中 &lt;br /&gt;18 结算完成 &lt;br /&gt;19结算失败 &lt;br /&gt;| 5|
| status1nm|String|| 同上| 待服务|
| usrconftm|datetime||用户确认完成时间| 2018-04-14 14:54:50|
| splitsttlfg|Integer|| 拆分结算标识0：未拆分结算，1已拆分结算| 0|
| continufee|Integer|| 结转金额| 0|
| chgstatus|Integer||  1 变更未开始 &lt;br /&gt;2 变更已开始&lt;br /&gt;| 0|
| sttlefg|Integer|| 结算标识：给用户退款订单结算掉，成功结算更新 0默认,1已结算| 0|&lt;/p&gt;

&lt;h3 id=&quot;订单详情表&quot;&gt;订单详情表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：用户下单、POS机下单、不发生支付的订单变更
2 修改条件：订单变更、订单结算（用户或POS发起的订单结算）、护工结束服务、其他影响状态变化的节点
3 终止条件：超时未支付、订单完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| orduid|String|必须| 订单号|ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| wuid|String|必须| 护工Uid| WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh|
| wstatncd|String|必须| 所属网点 该护工所属网点|31010700052 |
| statncd|String|必须|服务网点 订单服务网点（非网点，没有代码） |31010700052 |
| hospnm|String|必须| 服务医院 医院名称| 上海市同济大学附属同济医院(同济医院)|
| sitmid|Integer|必须| 服务项目 当ordtp属于院内时| |
| svctp|String|必须| 交易号| TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| startday|date|必须| 服务开始时间 默认当前日期| 2018-04-05|
| svcday|Integer|必须| 服务天数| 10|
| unitprice|Integer|必须|  服务项目单价| 9000|
| amount|Integer|必须| 服务项目小计 服务项目单价 X 服务天数（精算）| 90000|
| adjustday|decimal(4,2)|| 调整天数 -0.5 0  0.5 三个值，在最后一天结算| 0|
| status1|Integer|| 0 无状态&lt;br /&gt;1 预约中 &lt;br /&gt;2 预约成功&lt;br /&gt;3 待支付（在15分钟内付款，超时被取消） &lt;br /&gt;4 已支付（支付成功）.&lt;br /&gt;5 待服务（等待上门服务，计时）&lt;br /&gt;6 服务中（服务进度）&lt;br /&gt;7 待结算（等待结算并提示用户结算，超时关闭订单）&lt;br /&gt;8 已完成&lt;br /&gt;9 待评价 &lt;br /&gt;10 已评价&lt;br /&gt;11 已取消（取消成功） &lt;br /&gt;12 申请退款（发起退款申请） &lt;br /&gt;13 退款中（退款已受理，并进行退款程序） &lt;br /&gt;14 退款成功 （退款额转入用户账户） &lt;br /&gt;15 退款失败（提示失败原因）&lt;br /&gt;16 变更待服务&lt;br /&gt;17 结算中 &lt;br /&gt;18 结算完成 &lt;br /&gt;19结算失败 | 5|
| status1nm|String||同上 | 待服务|
| status3|Integer|| 状态-完成 0 无状态 1 完成 | 1|
| status3nm|String|| 状态-完成-说明 保存护工的做工状态 | 完成|
| factsvcfg|Integer|| 子单实际服务标识：0 是默认，1 是结算退款记录， 2 是退款记录{tips:该子单是否是实际服务单} | 0|&lt;/p&gt;

&lt;h3 id=&quot;支付信息表&quot;&gt;支付信息表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：支付、退款、结算等，有金额流转的情况
2 修改条件：支付成功后状态 paid状态更新，结算申请发起、结算状态更新、退款状态发起、退款状态更新。
3 终止条件：超时未支付、支付完成、结算完成、退款完成、
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| tradeno|String|必须| 支付订单号 tr+”-“+36位UUID（带-）&lt;br /&gt;微信线上支付 pt开头&lt;br /&gt;微信扫码支付 td开头&lt;br /&gt;银联支付 tr开头|TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| orduid|String|必须| 订单UID 订单主表ID| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| uopid|String|| 用户UID 支付者UID，不一定是被服务的患者|ooDqLwHXcSIFoMZxTX3DtHkLtaOM|
| fopid|String|| 推荐者UID 推荐者UID||
| ttype|Integer|| 订单类型 1医院 2医院单项 3居家|1|
| paid|Integer|| 是否已支付 &lt;br /&gt;0 未支付 &lt;br /&gt;1 线上支付 &lt;br /&gt;2 现金支付&lt;br /&gt;3 退款成功&lt;br /&gt;4 退款失败|1|
| paidtm|datetime|| 支付时间 非0的时候 才有值|2018-04-05 10:58:56|
| payment|Integer|| 支付方式 &lt;br /&gt;1 微信 &lt;br /&gt;2 刷卡（借记卡） &lt;br /&gt;3 刷卡（信用卡） &lt;br /&gt;4 现金（线下支付）&lt;br /&gt; 5 支付宝|1|
| amount|Integer|| 支付金额|90000|
| outorderno|String|| 外部订单号 外部订单号||
| outtransno|String|| 外部流水号 外部流水号|4200000095201804052560224795|
| resttlfg|Integer|| 预结算标志位：0未结算，1已结算||
| sttlfg|Integer|| 已结算标志 0未结算 1 已结算||
| sttlamt|Integer|| 结算金额||
| invoicetm|datetime|| 预分账标志位||
| reinvfg|Integer|| 分账标志||
| invoicefg|Integer|| ||
| refund|Integer|| 退款标志 现阶段价格统一。&lt;br /&gt;该字段为空，当每个省价格不同时，会用到。&lt;br /&gt;0是付款 1是退款|0|
| cardNo|String|| 银联支付用字段: 支付时所用的卡号(该字段当银联支付退款时使用)||
| transChnName|String|| 支付渠道名称||
| transEngName|String|| 支付渠道||
| refNo|String|| 银联支付用参考号||
| merchantNo|String|| 根据支付时的，商户编号||
| terminalNo|String|| pos机终端号码||
| traceNo|String|| 银联商务支付的记录号(每一个pos机从1开始计数)||&lt;/p&gt;

&lt;h3 id=&quot;日结表&quot;&gt;日结表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：开始服务的订单，每日12:30/23:30 进行结算
2 修改条件：无
3 终止条件：预付款消耗完为止
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| daysttuid|String|必须| 日结算UID|DST_VwACGXWSvbwTfEm9I_6dPyvWKkw2|
| orduid|String|必须| 订单UID 订单主表ID| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| porduid|String|必须| 母单orduid| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| sttdate|date|必须| 结算日期| 2018-04-05|
| wuid|String|必须| 护工wuid|WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh|
| daysttfee|Integer|| 日结算金额|9000|
| lessordfee|Integer|| 订单剩余金额(结余金额)|81000|
| daystttm|datetime|| 结算时间|2018-04-09 23:30:00|
| unitprice|Integer|| 单价 | 9000 |
| statncd|String|| 做单护工站 | 31010700052 |
| plusfee|String|| 增收 | 450 |
| wrkfee|String|| 护工工资 | 5400 |
| hospfee|String|| 医院管理费 | 900 |
| companyfee|String|| 管理费（公司管理费:statncd=wstatncd的时候该字段和服务项目单价拆分的公司管理费一致，如果statncd&amp;lt;&amp;gt;wstatncd三七开的订单，则此字段记录总利润 即=sttamount - wrkfee - recomfee） | 2033 |
| platamount|String|| 平台费用 | 0 |
| deptfee|String|| 科室费 | 100 |
| insuranfee|String|| 保险费 | 0 |
| recomfee|String|| 推荐有奖金额 | 0 |
| platformfee|String|| 护工点击结束后用户遗留平台金额 | 0 |
| payfee|String|| 支付金额 | 90000 |
| usrnewordfee|String|| 用户续单结转 | 0 |
| refundfee|String|| 退款金额 | 0 |&lt;/p&gt;

&lt;h3 id=&quot;结算表&quot;&gt;结算表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：结算完成
2 修改条件：无
3 终止条件：结算完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;字段名&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数类型&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;必须&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数说明&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参考值&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sttuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;日结算UID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ST_o9wTyvpiSuSqmbjsMonkilWvm7qXz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;orduid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;订单UID 订单主表ID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;subid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;订单Subid, 子单号&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;statncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;需求方所在护工站，如果院外非网点或居家为空&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wstatncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工所在护工站&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工wuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sttamount&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;结算金额(合算=医院管理费+护工工资+毛利润)&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;90000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unitprice&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;单价 护工身价*系数（目前100%）+保险&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;svcday&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;服务天数&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;plusfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;增收&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4500&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工工资&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;54000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;hospfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;医院管理费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;companyfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;管理费（公司管理费:statncd=wstatncd的时候该字段和服务项目单价拆分的公司管理费一致，如果statncd&amp;lt;&amp;gt;wstatncd三七开的订单，则此字段记录总利润 即=sttamount - wrkfee - recomfee）&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;21383&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platamount&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;平台费用&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;deptfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;科室费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;insuranfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;保险费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;recomfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;推荐有奖金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platformfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工点击结束后用户遗留平台金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;payfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;支付金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;90000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;usrnewordfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;用户续单结转&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;invoicefg&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;分账标识0未分账，1已分账 针对是否分账到qo_ord_fin_statn_invoice表而标识&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;isdowrkfeefg&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工工资标识&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;护工站分账明细&quot;&gt;护工站分账明细&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：结算完成
2 修改条件：无
3 终止条件：结算完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;字段名&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数类型&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;必须&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数说明&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参考值&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;finuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;利益分账UID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FI_5NN3QewfIAJPKvTANe2xwG8nPFmUM&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sttuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;日结算UID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ST_o9wTyvpiSuSqmbjsMonkilWvm7qXz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;orduid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;订单UID 订单主表ID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;requirstatncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;发单方statncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;requirfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;发单方收益&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkstatncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;派单方statncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkstatnfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;派单方收益&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工工资&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;54000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;hospfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;医院管理费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;recomfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;推荐有奖金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;insurfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;保险费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;plusfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;增收&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;suplid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;加盟商cd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;suplfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;发单方加盟商收益&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;21383&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platfeee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;平台遗留金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platamount&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;平台费用&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;护工工资表&quot;&gt;护工工资表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：护工点击完成服务，+15天之后分账
2 修改条件：无
3 终止条件：护工点击完成服务，+15天之后分账
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| wiuid|String|必须| 收入UIDWI开头32位UUID|WI_DxhX4TG2DPkqMyCLLETeUoa4nbtJ0|
| wuid|String|必须| 护工编号UIDWK开头32位UUID|WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh|
| witp|Integer|必须| 收入类型收入类型 1 订单 2 推荐分享 3 奖励 4 积分换取 |1|
| income|Integer|必须| 收入单位是分 |54000|
| status|Integer|必须| 状态&lt;br /&gt;0 订单服务中 &lt;br /&gt;1 等待结算  &lt;br /&gt;2 系统审核中 &lt;br /&gt;9已生效&lt;br /&gt; (订单服务中状态为0，&lt;br /&gt;订单服务截止之间到但未被结算状态为1,&lt;br /&gt;订单被投诉 状态为2，&lt;br /&gt;订单结束并结算再加14天 状态为9，) |2|
| cashed|Integer|必须| 是否已提现0 未体现 1 已提现 |1|
| cashtm|DateTime|必须| 提现时间提现的时间 |2018-04-09 23:30:00|&lt;/p&gt;

&lt;h2 id=&quot;订单状态变化与结算数据的流程&quot;&gt;订单状态变化与结算数据的流程&lt;/h2&gt;
&lt;h3 id=&quot;订单状态变化时序图&quot;&gt;订单状态变化(时序图):&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-sequence&quot;&gt;用户端-&amp;gt;[数据库]: 1 用户自主下单(院外订单)
用户端-&amp;gt;[数据库]: 2 用户自主下单(院内订单)
POS机-&amp;gt;[数据库]: POS机管理老师接单、并且派工
[批处理]-&amp;gt;[数据库]: 2小时无人反映，取消订单
用户端-&amp;gt;[数据库]: [￥支付 微信 ]
POS机-&amp;gt;[数据库]: [￥收款：微信/支付宝/银行卡/现金]
[批处理]-&amp;gt;[批处理]: 30分钟内不支付，支付状态超时
[批处理]--&amp;gt;[数据库]: 取消订单
[批处理]-&amp;gt;[批处理]: 支付成功之后，2小时内处于待服务状态，超过2小时进入服务中
[批处理]--&amp;gt;[数据库]: 待服务-&amp;gt;服务中
[数据库]--&amp;gt;用户端: 查看订单信息
[数据库]-&amp;gt;PC端: 查看订单信息
[数据库]-&amp;gt;护工端: 查看订单信息
护工端--&amp;gt;用户端: 推送服务日志
用户端-&amp;gt;[数据库]: 发起结算
[批处理]--&amp;gt;[批处理]: 发起结算、向银行请求数据、进入结算中状态
[批处理]--&amp;gt;[批处理]: 判断结算申请的结果、
[批处理]--&amp;gt;[数据库]: 结算成功/结算失败 -&amp;gt; 更新状态
[数据库]-&amp;gt;[数据库]: 服务结束时间判断
用户端--&amp;gt;护工端: 订单结算
护工端--&amp;gt;[数据库]: 服务结算
POS机--&amp;gt;用户端: 订单强制结算
POS机--&amp;gt;护工端: 订单强制结算
用户端-&amp;gt;[数据库]:用户评价、状态进入已评价状态
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;后台批处理接口说明&quot;&gt;后台批处理接口说明&lt;/h2&gt;

&lt;h3 id=&quot;01-支付超时的处理&quot;&gt;01. 支付超时的处理&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderCancelUnpaid&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 清理超过2小时的订单未支付的订单
 2 订单变更的处理，当2个小时内不支付，已经申请变更的订单自动变成过期未支付状态
 3 每天 8-20点之间，每分钟执行&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;02-订单变更审核超时的处理&quot;&gt;02. 订单变更审核超时的处理&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/cancelUnaplyToUnPayOrd&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 次日生效 24小时后 不审批 取消并且退款
 2 当日及时生效 6小时后 遍生效 取消并且退款&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;03-订单变更待服务的处理&quot;&gt;03. 订单变更待服务的处理&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderChangeSerStart&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 修改变更服务变成待服务(立即执行) 没有支付的订单变更
 2 只有审批通过的变更待服务才能进入服务状态，否者停留在永远待服务的状态
 3 每分钟执行&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;04-退款给用户的处理微信&quot;&gt;04. 退款给用户的处理（微信）&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderRefundToUser&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 判断订单状态为7，立即退款给用户
 2 每分钟执行&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;05-退款给用户的处理银联&quot;&gt;05. 退款给用户的处理（银联）&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/doRefundToUserUpay&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 判断订单状态为7，立即退款给用户
 2 每分钟执行&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;06-待服务进入服务中无需支付&quot;&gt;06. 待服务进入服务中(无需支付)&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderWaitSerToSer&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 订单支付成功2小时后，待服务进入服务中
 2 每分钟执行，订单支付时间到当前时间有2小时的订单&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;07-变更待服务进入服务中有支付&quot;&gt;07. 变更待服务进入服务中(有支付)&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderChangeWaitSerToSer&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 变更订单的等待状态变成开始服务 有支付状态的订单变更
 2 只有审批通过的变更待服务才能进入服务状态，否者停留在永远待服务的状态
 3 每分钟执行，订单支付时间到当前时间有2小时的订单&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;08-订单拆分&quot;&gt;08. 订单拆分&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/finSplitSttle&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 针对每个订单的拆分细则，拆分 护工工资、平台费、科室费、保险费、公司所得等费用&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;09-分账给护工站&quot;&gt;09. 分账给护工站&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/finInvoiceToStatn&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 针对每个订单的拆分细则，拆分 护工工资、平台费、科室费、保险费、公司所得等费用到具体的护工站&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;10-日结脚本&quot;&gt;10. 日结脚本&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/ordDayStt&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 针对每个订单做当日结算，消耗当天费用，并且拆分 护工工资、平台费、科室费、保险费、公司所得等费用
 2 每天12:30 23:30 跑该脚本&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;11-护工工资结算改变状态脚本&quot;&gt;11. 护工工资结算改变状态脚本&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/doSettleWrkfee&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 根据日结结果，计算每日护工工资
 2 每天1点15分 跑该脚本&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;12-订单逾期脚本&quot;&gt;12. 订单逾期脚本&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/ordFinishStt&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 结算到期订单用户未点击的订单 ，结算成逾期，并且释放床位
 2 每天1点30分 跑该脚本&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;13-订单结算状态脚本&quot;&gt;13. 订单结算状态脚本&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/doSttlement&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 对于用户已经点击结算，护工已经点击结束服务的订单，跑的脚本
 2 分钟跑该脚本&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name>kei gosling</name></author><summary type="html">01. 订单与结算逻辑.结算与支付</summary></entry><entry><title type="html">订单与结算逻辑 减免与优惠</title><link href="https://thefirstwind.github.io//2020-10-03-%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E5%87%8F%E5%85%8D%E4%B8%8E%E4%BC%98%E6%83%A0/" rel="alternate" type="text/html" title="订单与结算逻辑 减免与优惠" /><published>2020-10-03T00:00:00+08:00</published><updated>2020-10-03T00:00:00+08:00</updated><id>https://thefirstwind.github.io//%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E5%87%8F%E5%85%8D%E4%B8%8E%E4%BC%98%E6%83%A0</id><content type="html" xml:base="https://thefirstwind.github.io//2020-10-03-%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E5%87%8F%E5%85%8D%E4%B8%8E%E4%BC%98%E6%83%A0/">&lt;h1 id=&quot;04-订单与结算逻辑减免与优惠&quot;&gt;04. 订单与结算逻辑.减免与优惠&lt;/h1&gt;

&lt;blockquote&gt;

  &lt;ul&gt;
    &lt;li&gt;&lt;strong&gt;时间&lt;/strong&gt;：2018年9月8日&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;@[订单, 结算逻辑,减免与优惠]&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;[TOC]&lt;/p&gt;

&lt;h2 id=&quot;减免与优惠业务范围&quot;&gt;减免与优惠业务范围&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;p&gt;1 订单类型： 服务中-&amp;gt;结算申请&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;2 适用场景：&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;订单完结的时候，对订单结算金额 加减0.5天&lt;/li&gt;
    &lt;li&gt;订单完结的时候，减免应结算的 平台管理费、医院管理费等费用&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;数据字典&quot;&gt;数据字典&lt;/h2&gt;
&lt;h3 id=&quot;系统角色&quot;&gt;系统角色&lt;/h3&gt;
&lt;p&gt;| 端  |    用户群体 |    终端类型 | 终端名称  |
| :——– |:——–| :–: |:——–|
| 用户端  |患者、消费者 | 微信公众号 | E护通  |
| 护工端  |院内护工、居家护工 |  微信公众号  | E护通|护工  |
| 护士端  |提供上门服务的在册护士 | 微信公众号/APP  | 护通|专护 |
| POS机端 |擎浩医院管理老师| POS机  |  |
| PC端 |财务、运营、系统管理员等| PC电脑端 |   |
| 统计端|院方高层、护理界高层| 微信公众号  | 擎浩护理  |&lt;/p&gt;

&lt;h3 id=&quot;院内订单类型&quot;&gt;院内订单类型&lt;/h3&gt;
&lt;p&gt;| 订单类型  | 前提条件 |  工资计算说明|
| :——– |:——–| :–: |
| 1对1订单 | 院内有机动护工 | 系统计算、每日按照比例分配 |
| 1对多订单 | 当前病区绑定了护工 |  系统计算、每日按照比例分配   |
| 团队制订单| 当前病区支持团队制 | 不统计报表  |
| 单项订单 |擎浩医院管理老师| 待定 |&lt;/p&gt;

&lt;h3 id=&quot;订单状态&quot;&gt;订单状态&lt;/h3&gt;
&lt;p&gt;| 状态  | 状态名称 |  说明|
| :——– |:——–| :– |
| 0  | 无状态 | 空状态，冗余字段 |
| 1  | 预约中 | 院外抢单用状态 |
| 2  | 预约成功 | POS机管理老师代接单，并且派工之后的状态 |
| 3  | 待支付（在2小时内付款，超时被取消） | 院内订单下单之后的状态 |
| 4  | 已支付（支付成功） | 支付成功的状态 |
| 5  | 待服务（等待上门服务，计时） | 支付成功之后，2个小时之内保持待服务状态 |
| 6  | 服务中（服务进度） | 支付成功之后，2个小时之后进入服务中状态 |
| 7  | 待结算 | 用户(POS机)发起结算 （等待结算并提示用户结算，超时关闭订单）|
| 8  | 已完成 | 用户(POS机)发起结算之后，如果判断退款成功，状态变为完成 |
| 9  | 待评价 | 冗余状态 |
| 10  | 已评价 | 用户评价完成之后 |
| 11  | 已取消（取消成功） | 超时支付，自动变为取消|
| 12  | 申请退款（发起退款申请） | 待服务状态，申请全额退款的状态 |
| 13  | 退款中（退款已受理，并进行退款程序） | 发起退款的状态 |
| 14  | 退款成功 （退款额转入用户账户） | 用户(POS机)发起退款，如果确认退款成功，状态变为退款成功 |
| 15  | 退款失败（提示失败原因） | 用户(POS机)发起退款，如果确认退款失败，状态变为退款失败 |
| 16  | 变更待服务 | 发起订单变更之后的状态 |
| 17  | 结算中 | 用户(POS机)发起结算，状态变为结算中 |
| 18  | 结算完成 | 用户(POS机)发起结算，如果确认结算成功，状态变为结算完成 |
| 19  | 结算失败 | 用户(POS机)发起结算，如果确认结算失败，状态变为结算失败 |&lt;/p&gt;

&lt;h2 id=&quot;数据库设计&quot;&gt;数据库设计&lt;/h2&gt;

&lt;h3 id=&quot;订单主表&quot;&gt;订单主表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：无
2 修改条件：结算申请，调整结算金额
3 终止条件：结算申请，调整结算金额
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| orduid|String|必须| 订单号|ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| ordid|String|必须| 订单ID|1804050053004W|
| uopid|String|必须| 患者openid| ooDqLwHXcSIFoMZxTX3DtHkLtaOM|
| tradeno|String|必须| 支付UID| TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| ptorduid|String|必须| 患者姓名| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| rlnm|String|必须| 父订单号，续单用，初始值为其本身如果有续单或者纠纷负单则为其父单orduid| 王根娣|
| startday|date|必须| 服务开始时间 默认当前日期| 2018-04-05|
| svcday|Integer|必须| 服务天数| 10|
| statncd|String|必须| 护工站代码| 31010700052|
| statnnm|String|必须| 护工站| 上海市同济大学附属同济医院(同济医院)|
| amount|Integer|必须| 订单初始预收金额| 90000|
| ordlessfee|Integer|| 订单剩余金额| 0|
| status1|Integer|| 0 无状态  &lt;br /&gt;1 预约中 &lt;br /&gt;2 预约成功 &lt;br /&gt;3 待支付（在2小时内付款，超时被取消） &lt;br /&gt;4 已支付（支付成功）&lt;br /&gt;5 待服务（等待上门服务，计时）&lt;br /&gt;6 服务中（服务进度）&lt;br /&gt;7 待结算（等待结算并提示用户结算，超时关闭订单）&lt;br /&gt;8 已完成 &lt;br /&gt;9 待评价 &lt;br /&gt;10 已评价&lt;br /&gt; 11 已取消（取消成功） &lt;br /&gt;12 申请退款（发起退款申请） &lt;br /&gt;13 退款中（退款已受理，并进行退款程序） &lt;br /&gt;14 退款成功 （退款额转入用户账户） &lt;br /&gt;15 退款失败（提示失败原因） &lt;br /&gt;16 变更待服务 &lt;br /&gt;17 结算中 &lt;br /&gt;18 结算完成 &lt;br /&gt;19结算失败 &lt;br /&gt;| 5|
| status1nm|String|| 同上| 待服务|
| usrconftm|datetime||用户确认完成时间| 2018-04-14 14:54:50|
| splitsttlfg|Integer|| 拆分结算标识0：未拆分结算，1已拆分结算| 0|
| continufee|Integer|| 结转金额| 0|
| chgstatus|Integer||  1 变更未开始 &lt;br /&gt;2 变更已开始&lt;br /&gt;| 0|
| discfg|String||  优惠标识discfg：&lt;br /&gt;0：无优惠，&lt;br /&gt;1：全免，&lt;br /&gt;2：减免医院管理费，&lt;br /&gt;3：减免公司收入，&lt;br /&gt;4：减免增收,&lt;br /&gt;5：团队制减免| 0|
| discamount|Integer|| 优惠金额| 300|
| sttlefg|Integer|| 结算标识：给用户退款订单结算掉，成功结算更新 0默认,1已结算| 0|&lt;/p&gt;

&lt;h3 id=&quot;订单详情表&quot;&gt;订单详情表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：无
2 修改条件：结算申请，调整结算金额
3 终止条件：结算申请，调整结算金额
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| orduid|String|必须| 订单号|ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| wuid|String|必须| 护工Uid| WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh|
| wstatncd|String|必须| 所属网点 该护工所属网点|31010700052 |
| statncd|String|必须|服务网点 订单服务网点（非网点，没有代码） |31010700052 |
| hospnm|String|必须| 服务医院 医院名称| 上海市同济大学附属同济医院(同济医院)|
| sitmid|Integer|必须| 服务项目 当ordtp属于院内时| |
| svctp|String|必须| 交易号| TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| startday|date|必须| 服务开始时间 默认当前日期| 2018-04-05|
| svcday|Integer|必须| 服务天数| 10|
| unitprice|Integer|必须|  服务项目单价| 9000|
| amount|Integer|必须| 服务项目小计 服务项目单价 X 服务天数（精算）| 90000|
| adjustday|decimal(4,2)|| 调整天数 -0.5 0  0.5 三个值，在最后一天结算| 0|
| status1|Integer|| 0 无状态&lt;br /&gt;1 预约中 &lt;br /&gt;2 预约成功&lt;br /&gt;3 待支付（在15分钟内付款，超时被取消） &lt;br /&gt;4 已支付（支付成功）.&lt;br /&gt;5 待服务（等待上门服务，计时）&lt;br /&gt;6 服务中（服务进度）&lt;br /&gt;7 待结算（等待结算并提示用户结算，超时关闭订单）&lt;br /&gt;8 已完成&lt;br /&gt;9 待评价 &lt;br /&gt;10 已评价&lt;br /&gt;11 已取消（取消成功） &lt;br /&gt;12 申请退款（发起退款申请） &lt;br /&gt;13 退款中（退款已受理，并进行退款程序） &lt;br /&gt;14 退款成功 （退款额转入用户账户） &lt;br /&gt;15 退款失败（提示失败原因）&lt;br /&gt;16 变更待服务&lt;br /&gt;17 结算中 &lt;br /&gt;18 结算完成 &lt;br /&gt;19结算失败 | 5|
| status1nm|String||同上 | 待服务|
| status3|Integer|| 状态-完成 0 无状态 1 完成 | 1|
| status3nm|String|| 状态-完成-说明 保存护工的做工状态 | 完成|
| factsvcfg|Integer|| 子单实际服务标识：0 是默认，1 是结算退款记录， 2 是退款记录{tips:该子单是否是实际服务单} | 0|&lt;/p&gt;

&lt;h3 id=&quot;支付信息表&quot;&gt;支付信息表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：支付、退款、结算等，有金额流转的情况
2 修改条件：支付成功后状态 paid状态更新，结算申请发起、结算状态更新、退款状态发起、退款状态更新。
3 终止条件：超时未支付、支付完成、结算完成、退款完成、
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| tradeno|String|必须| 支付订单号 tr+”-“+36位UUID（带-）&lt;br /&gt;微信线上支付 pt开头&lt;br /&gt;微信扫码支付 td开头&lt;br /&gt;银联支付 tr开头|TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| orduid|String|必须| 订单UID 订单主表ID| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| uopid|String|| 用户UID 支付者UID，不一定是被服务的患者|ooDqLwHXcSIFoMZxTX3DtHkLtaOM|
| fopid|String|| 推荐者UID 推荐者UID||
| ttype|Integer|| 订单类型 1医院 2医院单项 3居家|1|
| paid|Integer|| 是否已支付 &lt;br /&gt;0 未支付 &lt;br /&gt;1 线上支付 &lt;br /&gt;2 现金支付&lt;br /&gt;3 退款成功&lt;br /&gt;4 退款失败|1|
| paidtm|datetime|| 支付时间 非0的时候 才有值|2018-04-05 10:58:56|
| payment|Integer|| 支付方式 &lt;br /&gt;1 微信 &lt;br /&gt;2 刷卡（借记卡） &lt;br /&gt;3 刷卡（信用卡） &lt;br /&gt;4 现金（线下支付）&lt;br /&gt; 5 支付宝|1|
| amount|Integer|| 支付金额|90000|
| outorderno|String|| 外部订单号 外部订单号||
| outtransno|String|| 外部流水号 外部流水号|4200000095201804052560224795|
| resttlfg|Integer|| 预结算标志位：0未结算，1已结算||
| sttlfg|Integer|| 已结算标志 0未结算 1 已结算||
| sttlamt|Integer|| 结算金额||
| invoicetm|datetime|| 预分账标志位||
| reinvfg|Integer|| 分账标志||
| invoicefg|Integer|| ||
| refund|Integer|| 退款标志 现阶段价格统一。&lt;br /&gt;该字段为空，当每个省价格不同时，会用到。&lt;br /&gt;0是付款 1是退款|0|
| cardNo|String|| 银联支付用字段: 支付时所用的卡号(该字段当银联支付退款时使用)||
| transChnName|String|| 支付渠道名称||
| transEngName|String|| 支付渠道||
| refNo|String|| 银联支付用参考号||
| merchantNo|String|| 根据支付时的，商户编号||
| terminalNo|String|| pos机终端号码||
| traceNo|String|| 银联商务支付的记录号(每一个pos机从1开始计数)||&lt;/p&gt;

&lt;h3 id=&quot;日结表&quot;&gt;日结表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：开始服务的订单，每日12:30/23:30 进行结算
2 修改条件：无
3 终止条件：预付款消耗完为止
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| daysttuid|String|必须| 日结算UID|DST_VwACGXWSvbwTfEm9I_6dPyvWKkw2|
| orduid|String|必须| 订单UID 订单主表ID| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| porduid|String|必须| 母单orduid| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| sttdate|date|必须| 结算日期| 2018-04-05|
| wuid|String|必须| 护工wuid|WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh|
| daysttfee|Integer|| 日结算金额|9000|
| lessordfee|Integer|| 订单剩余金额(结余金额)|81000|
| daystttm|datetime|| 结算时间|2018-04-09 23:30:00|
| unitprice|Integer|| 单价 | 9000 |
| statncd|String|| 做单护工站 | 31010700052 |
| plusfee|String|| 增收 | 450 |
| wrkfee|String|| 护工工资 | 5400 |
| hospfee|String|| 医院管理费 | 900 |
| companyfee|String|| 管理费（公司管理费:statncd=wstatncd的时候该字段和服务项目单价拆分的公司管理费一致，如果statncd&amp;lt;&amp;gt;wstatncd三七开的订单，则此字段记录总利润 即=sttamount - wrkfee - recomfee） | 2033 |
| platamount|String|| 平台费用 | 0 |
| deptfee|String|| 科室费 | 100 |
| insuranfee|String|| 保险费 | 0 |
| recomfee|String|| 推荐有奖金额 | 0 |
| platformfee|String|| 护工点击结束后用户遗留平台金额 | 0 |
| payfee|String|| 支付金额 | 90000 |
| usrnewordfee|String|| 用户续单结转 | 0 |
| refundfee|String|| 退款金额 | 0 |&lt;/p&gt;

&lt;h3 id=&quot;结算表&quot;&gt;结算表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：结算完成
2 修改条件：无
3 终止条件：结算完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;字段名&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数类型&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;必须&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数说明&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参考值&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sttuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;日结算UID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ST_o9wTyvpiSuSqmbjsMonkilWvm7qXz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;orduid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;订单UID 订单主表ID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;subid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;订单Subid, 子单号&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;statncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;需求方所在护工站，如果院外非网点或居家为空&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wstatncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工所在护工站&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工wuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sttamount&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;结算金额(合算=医院管理费+护工工资+毛利润)&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;90000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unitprice&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;单价 护工身价*系数（目前100%）+保险&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;svcday&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;服务天数&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;plusfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;增收&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4500&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工工资&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;54000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;hospfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;医院管理费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;companyfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;管理费（公司管理费:statncd=wstatncd的时候该字段和服务项目单价拆分的公司管理费一致，如果statncd&amp;lt;&amp;gt;wstatncd三七开的订单，则此字段记录总利润 即=sttamount - wrkfee - recomfee）&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;21383&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platamount&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;平台费用&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;deptfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;科室费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;insuranfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;保险费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;recomfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;推荐有奖金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platformfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工点击结束后用户遗留平台金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;payfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;支付金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;90000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;usrnewordfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;用户续单结转&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;invoicefg&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;分账标识0未分账，1已分账 针对是否分账到qo_ord_fin_statn_invoice表而标识&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;isdowrkfeefg&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工工资标识&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;护工站分账明细&quot;&gt;护工站分账明细&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：结算完成
2 修改条件：无
3 终止条件：结算完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;字段名&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数类型&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;必须&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数说明&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参考值&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;finuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;利益分账UID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FI_5NN3QewfIAJPKvTANe2xwG8nPFmUM&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sttuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;日结算UID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ST_o9wTyvpiSuSqmbjsMonkilWvm7qXz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;orduid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;订单UID 订单主表ID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;requirstatncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;发单方statncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;requirfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;发单方收益&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkstatncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;派单方statncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkstatnfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;派单方收益&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工工资&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;54000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;hospfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;医院管理费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;recomfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;推荐有奖金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;insurfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;保险费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;plusfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;增收&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;suplid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;加盟商cd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;suplfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;发单方加盟商收益&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;21383&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platfeee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;平台遗留金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platamount&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;平台费用&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;护工工资表&quot;&gt;护工工资表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：护工点击完成服务，+15天之后分账
2 修改条件：无
3 终止条件：护工点击完成服务，+15天之后分账
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| wiuid|String|必须| 收入UIDWI开头32位UUID|WI_DxhX4TG2DPkqMyCLLETeUoa4nbtJ0|
| wuid|String|必须| 护工编号UIDWK开头32位UUID|WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh|
| witp|Integer|必须| 收入类型收入类型 1 订单 2 推荐分享 3 奖励 4 积分换取 |1|
| income|Integer|必须| 收入单位是分 |54000|
| status|Integer|必须| 状态&lt;br /&gt;0 订单服务中 &lt;br /&gt;1 等待结算  &lt;br /&gt;2 系统审核中 &lt;br /&gt;9已生效&lt;br /&gt; (订单服务中状态为0，&lt;br /&gt;订单服务截止之间到但未被结算状态为1,&lt;br /&gt;订单被投诉 状态为2，&lt;br /&gt;订单结束并结算再加14天 状态为9，) |2|
| cashed|Integer|必须| 是否已提现0 未体现 1 已提现 |1|
| cashtm|DateTime|必须| 提现时间提现的时间 |2018-04-09 23:30:00|&lt;/p&gt;

&lt;h2 id=&quot;订单减免的流程&quot;&gt;订单减免的流程&lt;/h2&gt;
&lt;h3 id=&quot;加减05天的结算时序图&quot;&gt;加减0.5天的结算(时序图):&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-sequence&quot;&gt;POS机-&amp;gt;[数据库]: 管理老师带用户发起结算申请、加减0.5天
[批处理]--&amp;gt;[数据库]: 查找发起结算的订单
[批处理]--&amp;gt;[批处理]: 发起结算、向银行请求数据、进入结算中状态
[批处理]--&amp;gt;[批处理]: 判断结算申请的结果、
[批处理]--&amp;gt;[数据库]: 结算成功/结算失败 -&amp;gt; 更新状态
[批处理]-&amp;gt;[批处理]: 服务结束时间判断
[批处理]--&amp;gt;用户端: 通知用户服务结束
[批处理]--&amp;gt;护工端: 通知护工服务结束
护工端--&amp;gt;[数据库]: 确认结算状态
用户端--&amp;gt;[数据库]: 确认结算状态

&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;优惠单的结算&quot;&gt;优惠单的结算:&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-sequence&quot;&gt;POS机-&amp;gt;[数据库]: 1 发起结算申请（无优惠)
POS机-&amp;gt;[数据库]: 2 发起结算申请（全部费用免除)
POS机-&amp;gt;[数据库]: 3 发起结算申请（减免医院管理费)
POS机-&amp;gt;[数据库]: 4 发起结算申请（减免公司收入)
POS机-&amp;gt;[数据库]: 5 发起结算申请（减免增收)
POS机-&amp;gt;[数据库]: 6 发起结算申请（团队制减免)
[批处理]--&amp;gt;[数据库]: 查找发起结算的订单
[[批处理]--&amp;gt;[批处理]: 发起结算、向银行请求数据、进入结算中状态
[批处理]--&amp;gt;[批处理]: 判断结算申请的结果、
[批处理]--&amp;gt;[数据库]: 结算成功/结算失败 -&amp;gt; 更新状态
[批处理]--&amp;gt;用户端: 通知用户服务已开始
[批处理]--&amp;gt;护工端: 通知旧护工服务已结束
[批处理]--&amp;gt;护工端: 通知新护工服务已开始
[数据库]--&amp;gt;用户端: 查看订单信息
[数据库]-&amp;gt;PC端: 查看订单信息
[数据库]-&amp;gt;护工端: 查看订单信息
用户端-&amp;gt;[数据库]:用户评价、状态进入已评价状态
&lt;/code&gt;&lt;/pre&gt;</content><author><name>kei gosling</name></author><summary type="html">04. 订单与结算逻辑.减免与优惠</summary></entry><entry><title type="html">订单与结算逻辑 代下单</title><link href="https://thefirstwind.github.io//2020-10-03-%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E4%BB%A3%E4%B8%8B%E5%8D%95/" rel="alternate" type="text/html" title="订单与结算逻辑 代下单" /><published>2020-10-03T00:00:00+08:00</published><updated>2020-10-03T00:00:00+08:00</updated><id>https://thefirstwind.github.io//%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E4%BB%A3%E4%B8%8B%E5%8D%95</id><content type="html" xml:base="https://thefirstwind.github.io//2020-10-03-%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E4%BB%A3%E4%B8%8B%E5%8D%95/">&lt;h1 id=&quot;01-订单与结算逻辑结算与支付&quot;&gt;01. 订单与结算逻辑.结算与支付&lt;/h1&gt;

&lt;blockquote&gt;

  &lt;ul&gt;
    &lt;li&gt;&lt;strong&gt;时间&lt;/strong&gt;：2018年8月23日&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;@[订单, 结算逻辑]&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;[TOC]&lt;/p&gt;

&lt;h2 id=&quot;数据字典&quot;&gt;数据字典&lt;/h2&gt;

&lt;h3 id=&quot;系统角色&quot;&gt;系统角色&lt;/h3&gt;
&lt;p&gt;| 端  |    用户群体 |    终端类型 | 终端名称  |
| :——– |:——–| :–: |:——–|
| 用户端  |患者、消费者 | 微信公众号 | E护通  |
| 护工端  |院内护工、居家护工 |  微信公众号  | E护通|护工  |
| 护士端  |提供上门服务的在册护士 | 微信公众号/APP  | 护通|专护 |
| POS机端 |擎浩医院管理老师| POS机  |  |
| PC端 |财务、运营、系统管理员等| PC电脑端 |   |
| 统计端|院方高层、护理界高层| 微信公众号  | 擎浩护理  |&lt;/p&gt;

&lt;h3 id=&quot;院内订单类型&quot;&gt;院内订单类型&lt;/h3&gt;
&lt;p&gt;| 订单类型  | 前提条件 |  工资计算说明|
| :——– |:——–| :–: |
| 1对1订单 | 院内有机动护工 | 系统计算、每日按照比例分配 |
| 1对多订单 | 当前病区绑定了护工 |  系统计算、每日按照比例分配   |
| 团队制订单| 当前病区支持团队制 | 不统计报表  |
| 单项订单 |擎浩医院管理老师| 待定 |&lt;/p&gt;

&lt;h3 id=&quot;订单状态&quot;&gt;订单状态&lt;/h3&gt;
&lt;p&gt;| 状态  | 状态名称 |  说明|
| :——– |:——–| :– |
| 0  | 无状态 | 空状态，冗余字段 |
| 1  | 预约中 | 院外抢单用状态 |
| 2  | 预约成功 | POS机管理老师代接单，并且派工之后的状态 |
| 3  | 待支付（在2小时内付款，超时被取消） | 院内订单下单之后的状态 |
| 4  | 已支付（支付成功） | 支付成功的状态 |
| 5  | 待服务（等待上门服务，计时） | 支付成功之后，2个小时之内保持待服务状态 |
| 6  | 服务中（服务进度） | 支付成功之后，2个小时之后进入服务中状态 |
| 7  | 待结算 | 用户(POS机)发起结算 （等待结算并提示用户结算，超时关闭订单）|
| 8  | 已完成 | 用户(POS机)发起结算之后，如果判断退款成功，状态变为完成 |
| 9  | 待评价 | 冗余状态 |
| 10  | 已评价 | 用户评价完成之后 |
| 11  | 已取消（取消成功） | 超时支付，自动变为取消|
| 12  | 申请退款（发起退款申请） | 待服务状态，申请全额退款的状态 |
| 13  | 退款中（退款已受理，并进行退款程序） | 发起退款的状态 |
| 14  | 退款成功 （退款额转入用户账户） | 用户(POS机)发起退款，如果确认退款成功，状态变为退款成功 |
| 15  | 退款失败（提示失败原因） | 用户(POS机)发起退款，如果确认退款失败，状态变为退款失败 |
| 16  | 变更待服务 | 发起订单变更之后的状态 |
| 17  | 结算中 | 用户(POS机)发起结算，状态变为结算中 |
| 18  | 结算完成 | 用户(POS机)发起结算，如果确认结算成功，状态变为结算完成 |
| 19  | 结算失败 | 用户(POS机)发起结算，如果确认结算失败，状态变为结算失败 |&lt;/p&gt;

&lt;h2 id=&quot;数据库设计&quot;&gt;数据库设计&lt;/h2&gt;

&lt;h3 id=&quot;订单主表&quot;&gt;订单主表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：用户下单、POS机下单、发生支付的订单变更
2 修改条件：支付、超时未支付、补录患者信息、订单变更、订单结算（用户或者POS发起的结算）、其他影响状态变化的节点
3 终止条件：超时未支付、订单完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| orduid|String|必须| 订单号|ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| ordid|String|必须| 订单ID|1804050053004W|
| uopid|String|必须| 患者openid| ooDqLwHXcSIFoMZxTX3DtHkLtaOM|
| tradeno|String|必须| 支付UID| TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| ptorduid|String|必须| 患者姓名| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| rlnm|String|必须| 父订单号，续单用，初始值为其本身如果有续单或者纠纷负单则为其父单orduid| 王根娣|
| startday|date|必须| 服务开始时间 默认当前日期| 2018-04-05|
| svcday|Integer|必须| 服务天数| 10|
| statncd|String|必须| 护工站代码| 31010700052|
| statnnm|String|必须| 护工站| 上海市同济大学附属同济医院(同济医院)|
| amount|Integer|必须| 订单初始预收金额| 90000|
| ordlessfee|Integer|| 订单剩余金额| 0|
| status1|Integer|| 0 无状态  &lt;br /&gt;1 预约中 &lt;br /&gt;2 预约成功 &lt;br /&gt;3 待支付（在2小时内付款，超时被取消） &lt;br /&gt;4 已支付（支付成功）&lt;br /&gt;5 待服务（等待上门服务，计时）&lt;br /&gt;6 服务中（服务进度）&lt;br /&gt;7 待结算（等待结算并提示用户结算，超时关闭订单）&lt;br /&gt;8 已完成 &lt;br /&gt;9 待评价 &lt;br /&gt;10 已评价&lt;br /&gt; 11 已取消（取消成功） &lt;br /&gt;12 申请退款（发起退款申请） &lt;br /&gt;13 退款中（退款已受理，并进行退款程序） &lt;br /&gt;14 退款成功 （退款额转入用户账户） &lt;br /&gt;15 退款失败（提示失败原因） &lt;br /&gt;16 变更待服务 &lt;br /&gt;17 结算中 &lt;br /&gt;18 结算完成 &lt;br /&gt;19结算失败 &lt;br /&gt;| 5|
| status1nm|String|| 同上| 待服务|
| usrconftm|datetime||用户确认完成时间| 2018-04-14 14:54:50|
| splitsttlfg|Integer|| 拆分结算标识0：未拆分结算，1已拆分结算| 0|
| continufee|Integer|| 结转金额| 0|
| chgstatus|Integer||  1 变更未开始 &lt;br /&gt;2 变更已开始&lt;br /&gt;| 0|
| sttlefg|Integer|| 结算标识：给用户退款订单结算掉，成功结算更新 0默认,1已结算| 0|&lt;/p&gt;

&lt;h3 id=&quot;订单详情表&quot;&gt;订单详情表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：用户下单、POS机下单、不发生支付的订单变更
2 修改条件：订单变更、订单结算（用户或POS发起的订单结算）、护工结束服务、其他影响状态变化的节点
3 终止条件：超时未支付、订单完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| orduid|String|必须| 订单号|ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| wuid|String|必须| 护工Uid| WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh|
| wstatncd|String|必须| 所属网点 该护工所属网点|31010700052 |
| statncd|String|必须|服务网点 订单服务网点（非网点，没有代码） |31010700052 |
| hospnm|String|必须| 服务医院 医院名称| 上海市同济大学附属同济医院(同济医院)|
| sitmid|Integer|必须| 服务项目 当ordtp属于院内时| |
| svctp|String|必须| 交易号| TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| startday|date|必须| 服务开始时间 默认当前日期| 2018-04-05|
| svcday|Integer|必须| 服务天数| 10|
| unitprice|Integer|必须|  服务项目单价| 9000|
| amount|Integer|必须| 服务项目小计 服务项目单价 X 服务天数（精算）| 90000|
| adjustday|decimal(4,2)|| 调整天数 -0.5 0  0.5 三个值，在最后一天结算| 0|
| status1|Integer|| 0 无状态&lt;br /&gt;1 预约中 &lt;br /&gt;2 预约成功&lt;br /&gt;3 待支付（在15分钟内付款，超时被取消） &lt;br /&gt;4 已支付（支付成功）.&lt;br /&gt;5 待服务（等待上门服务，计时）&lt;br /&gt;6 服务中（服务进度）&lt;br /&gt;7 待结算（等待结算并提示用户结算，超时关闭订单）&lt;br /&gt;8 已完成&lt;br /&gt;9 待评价 &lt;br /&gt;10 已评价&lt;br /&gt;11 已取消（取消成功） &lt;br /&gt;12 申请退款（发起退款申请） &lt;br /&gt;13 退款中（退款已受理，并进行退款程序） &lt;br /&gt;14 退款成功 （退款额转入用户账户） &lt;br /&gt;15 退款失败（提示失败原因）&lt;br /&gt;16 变更待服务&lt;br /&gt;17 结算中 &lt;br /&gt;18 结算完成 &lt;br /&gt;19结算失败 | 5|
| status1nm|String||同上 | 待服务|
| status3|Integer|| 状态-完成 0 无状态 1 完成 | 1|
| status3nm|String|| 状态-完成-说明 保存护工的做工状态 | 完成|
| factsvcfg|Integer|| 子单实际服务标识：0 是默认，1 是结算退款记录， 2 是退款记录{tips:该子单是否是实际服务单} | 0|&lt;/p&gt;

&lt;h3 id=&quot;支付信息表&quot;&gt;支付信息表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：支付、退款、结算等，有金额流转的情况
2 修改条件：支付成功后状态 paid状态更新，结算申请发起、结算状态更新、退款状态发起、退款状态更新。
3 终止条件：超时未支付、支付完成、结算完成、退款完成、
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| tradeno|String|必须| 支付订单号 tr+”-“+36位UUID（带-）&lt;br /&gt;微信线上支付 pt开头&lt;br /&gt;微信扫码支付 td开头&lt;br /&gt;银联支付 tr开头|TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| orduid|String|必须| 订单UID 订单主表ID| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| uopid|String|| 用户UID 支付者UID，不一定是被服务的患者|ooDqLwHXcSIFoMZxTX3DtHkLtaOM|
| fopid|String|| 推荐者UID 推荐者UID||
| ttype|Integer|| 订单类型 1医院 2医院单项 3居家|1|
| paid|Integer|| 是否已支付 &lt;br /&gt;0 未支付 &lt;br /&gt;1 线上支付 &lt;br /&gt;2 现金支付&lt;br /&gt;3 退款成功&lt;br /&gt;4 退款失败|1|
| paidtm|datetime|| 支付时间 非0的时候 才有值|2018-04-05 10:58:56|
| payment|Integer|| 支付方式 &lt;br /&gt;1 微信 &lt;br /&gt;2 刷卡（借记卡） &lt;br /&gt;3 刷卡（信用卡） &lt;br /&gt;4 现金（线下支付）&lt;br /&gt; 5 支付宝|1|
| amount|Integer|| 支付金额|90000|
| outorderno|String|| 外部订单号 外部订单号||
| outtransno|String|| 外部流水号 外部流水号|4200000095201804052560224795|
| resttlfg|Integer|| 预结算标志位：0未结算，1已结算||
| sttlfg|Integer|| 已结算标志 0未结算 1 已结算||
| sttlamt|Integer|| 结算金额||
| invoicetm|datetime|| 预分账标志位||
| reinvfg|Integer|| 分账标志||
| invoicefg|Integer|| ||
| refund|Integer|| 退款标志 现阶段价格统一。&lt;br /&gt;该字段为空，当每个省价格不同时，会用到。&lt;br /&gt;0是付款 1是退款|0|
| cardNo|String|| 银联支付用字段: 支付时所用的卡号(该字段当银联支付退款时使用)||
| transChnName|String|| 支付渠道名称||
| transEngName|String|| 支付渠道||
| refNo|String|| 银联支付用参考号||
| merchantNo|String|| 根据支付时的，商户编号||
| terminalNo|String|| pos机终端号码||
| traceNo|String|| 银联商务支付的记录号(每一个pos机从1开始计数)||&lt;/p&gt;

&lt;h3 id=&quot;日结表&quot;&gt;日结表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：开始服务的订单，每日12:30/23:30 进行结算
2 修改条件：无
3 终止条件：预付款消耗完为止
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| daysttuid|String|必须| 日结算UID|DST_VwACGXWSvbwTfEm9I_6dPyvWKkw2|
| orduid|String|必须| 订单UID 订单主表ID| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| porduid|String|必须| 母单orduid| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| sttdate|date|必须| 结算日期| 2018-04-05|
| wuid|String|必须| 护工wuid|WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh|
| daysttfee|Integer|| 日结算金额|9000|
| lessordfee|Integer|| 订单剩余金额(结余金额)|81000|
| daystttm|datetime|| 结算时间|2018-04-09 23:30:00|
| unitprice|Integer|| 单价 | 9000 |
| statncd|String|| 做单护工站 | 31010700052 |
| plusfee|String|| 增收 | 450 |
| wrkfee|String|| 护工工资 | 5400 |
| hospfee|String|| 医院管理费 | 900 |
| companyfee|String|| 管理费（公司管理费:statncd=wstatncd的时候该字段和服务项目单价拆分的公司管理费一致，如果statncd&amp;lt;&amp;gt;wstatncd三七开的订单，则此字段记录总利润 即=sttamount - wrkfee - recomfee） | 2033 |
| platamount|String|| 平台费用 | 0 |
| deptfee|String|| 科室费 | 100 |
| insuranfee|String|| 保险费 | 0 |
| recomfee|String|| 推荐有奖金额 | 0 |
| platformfee|String|| 护工点击结束后用户遗留平台金额 | 0 |
| payfee|String|| 支付金额 | 90000 |
| usrnewordfee|String|| 用户续单结转 | 0 |
| refundfee|String|| 退款金额 | 0 |&lt;/p&gt;

&lt;h3 id=&quot;结算表&quot;&gt;结算表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：结算完成
2 修改条件：无
3 终止条件：结算完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;字段名&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数类型&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;必须&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数说明&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参考值&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sttuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;日结算UID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ST_o9wTyvpiSuSqmbjsMonkilWvm7qXz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;orduid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;订单UID 订单主表ID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;subid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;订单Subid, 子单号&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;statncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;需求方所在护工站，如果院外非网点或居家为空&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wstatncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工所在护工站&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工wuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sttamount&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;结算金额(合算=医院管理费+护工工资+毛利润)&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;90000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unitprice&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;单价 护工身价*系数（目前100%）+保险&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;svcday&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;服务天数&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;plusfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;增收&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4500&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工工资&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;54000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;hospfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;医院管理费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;companyfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;管理费（公司管理费:statncd=wstatncd的时候该字段和服务项目单价拆分的公司管理费一致，如果statncd&amp;lt;&amp;gt;wstatncd三七开的订单，则此字段记录总利润 即=sttamount - wrkfee - recomfee）&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;21383&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platamount&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;平台费用&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;deptfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;科室费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;insuranfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;保险费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;recomfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;推荐有奖金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platformfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工点击结束后用户遗留平台金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;payfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;支付金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;90000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;usrnewordfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;用户续单结转&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;invoicefg&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;分账标识0未分账，1已分账 针对是否分账到qo_ord_fin_statn_invoice表而标识&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;isdowrkfeefg&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工工资标识&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;护工站分账明细&quot;&gt;护工站分账明细&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：结算完成
2 修改条件：无
3 终止条件：结算完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;字段名&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数类型&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;必须&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数说明&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参考值&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;finuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;利益分账UID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FI_5NN3QewfIAJPKvTANe2xwG8nPFmUM&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sttuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;日结算UID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ST_o9wTyvpiSuSqmbjsMonkilWvm7qXz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;orduid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;订单UID 订单主表ID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;requirstatncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;发单方statncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;requirfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;发单方收益&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkstatncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;派单方statncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010700052&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkstatnfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;派单方收益&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wrkfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工工资&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;54000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;hospfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;医院管理费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;recomfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;推荐有奖金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;insurfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;保险费&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;plusfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;增收&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;suplid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;加盟商cd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;suplfee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;发单方加盟商收益&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;21383&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platfeee&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;平台遗留金额&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;platamount&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;平台费用&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;护工工资表&quot;&gt;护工工资表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：护工点击完成服务，+15天之后分账
2 修改条件：无
3 终止条件：护工点击完成服务，+15天之后分账
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| wiuid|String|必须| 收入UIDWI开头32位UUID|WI_DxhX4TG2DPkqMyCLLETeUoa4nbtJ0|
| wuid|String|必须| 护工编号UIDWK开头32位UUID|WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh|
| witp|Integer|必须| 收入类型收入类型 1 订单 2 推荐分享 3 奖励 4 积分换取 |1|
| income|Integer|必须| 收入单位是分 |54000|
| status|Integer|必须| 状态&lt;br /&gt;0 订单服务中 &lt;br /&gt;1 等待结算  &lt;br /&gt;2 系统审核中 &lt;br /&gt;9已生效&lt;br /&gt; (订单服务中状态为0，&lt;br /&gt;订单服务截止之间到但未被结算状态为1,&lt;br /&gt;订单被投诉 状态为2，&lt;br /&gt;订单结束并结算再加14天 状态为9，) |2|
| cashed|Integer|必须| 是否已提现0 未体现 1 已提现 |1|
| cashtm|DateTime|必须| 提现时间提现的时间 |2018-04-09 23:30:00|&lt;/p&gt;

&lt;h2 id=&quot;订单状态变化与结算数据的流程&quot;&gt;订单状态变化与结算数据的流程&lt;/h2&gt;
&lt;h3 id=&quot;订单状态变化时序图&quot;&gt;订单状态变化(时序图):&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-sequence&quot;&gt;用户端-&amp;gt;[数据库]: 1 用户自主下单(院外订单)
用户端-&amp;gt;[数据库]: 2 用户自主下单(院内订单)
POS机-&amp;gt;[数据库]: POS机管理老师接单、并且派工
[批处理]-&amp;gt;[数据库]: 2小时无人反映，取消订单
用户端-&amp;gt;[数据库]: [￥支付 微信 ]
POS机-&amp;gt;[数据库]: [￥收款：微信/支付宝/银行卡/现金]
[批处理]-&amp;gt;[批处理]: 30分钟内不支付，支付状态超时
[批处理]--&amp;gt;[数据库]: 取消订单
[批处理]-&amp;gt;[批处理]: 支付成功之后，2小时内处于待服务状态，超过2小时进入服务中
[批处理]--&amp;gt;[数据库]: 待服务-&amp;gt;服务中
[数据库]--&amp;gt;用户端: 查看订单信息
[数据库]-&amp;gt;PC端: 查看订单信息
[数据库]-&amp;gt;护工端: 查看订单信息
护工端--&amp;gt;用户端: 推送服务日志
用户端-&amp;gt;[数据库]: 发起结算
[批处理]--&amp;gt;[批处理]: 发起结算、向银行请求数据、进入结算中状态
[批处理]--&amp;gt;[批处理]: 判断结算申请的结果、
[批处理]--&amp;gt;[数据库]: 结算成功/结算失败 -&amp;gt; 更新状态
[数据库]-&amp;gt;[数据库]: 服务结束时间判断
用户端--&amp;gt;护工端: 订单结算
护工端--&amp;gt;[数据库]: 服务结算
POS机--&amp;gt;用户端: 订单强制结算
POS机--&amp;gt;护工端: 订单强制结算
用户端-&amp;gt;[数据库]:用户评价、状态进入已评价状态
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;后台批处理接口说明&quot;&gt;后台批处理接口说明&lt;/h2&gt;

&lt;h3 id=&quot;01-支付超时的处理&quot;&gt;01. 支付超时的处理&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderCancelUnpaid&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 清理超过2小时的订单未支付的订单
 2 订单变更的处理，当2个小时内不支付，已经申请变更的订单自动变成过期未支付状态
 3 每天 8-20点之间，每分钟执行&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;02-订单变更审核超时的处理&quot;&gt;02. 订单变更审核超时的处理&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/cancelUnaplyToUnPayOrd&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 次日生效 24小时后 不审批 取消并且退款
 2 当日及时生效 6小时后 遍生效 取消并且退款&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;03-订单变更待服务的处理&quot;&gt;03. 订单变更待服务的处理&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderChangeSerStart&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 修改变更服务变成待服务(立即执行) 没有支付的订单变更
 2 只有审批通过的变更待服务才能进入服务状态，否者停留在永远待服务的状态
 3 每分钟执行&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;04-退款给用户的处理微信&quot;&gt;04. 退款给用户的处理（微信）&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderRefundToUser&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 判断订单状态为7，立即退款给用户
 2 每分钟执行&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;05-退款给用户的处理银联&quot;&gt;05. 退款给用户的处理（银联）&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/doRefundToUserUpay&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 判断订单状态为7，立即退款给用户
 2 每分钟执行&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;06-待服务进入服务中无需支付&quot;&gt;06. 待服务进入服务中(无需支付)&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderWaitSerToSer&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 订单支付成功2小时后，待服务进入服务中
 2 每分钟执行，订单支付时间到当前时间有2小时的订单&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;07-变更待服务进入服务中有支付&quot;&gt;07. 变更待服务进入服务中(有支付)&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderChangeWaitSerToSer&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 变更订单的等待状态变成开始服务 有支付状态的订单变更
 2 只有审批通过的变更待服务才能进入服务状态，否者停留在永远待服务的状态
 3 每分钟执行，订单支付时间到当前时间有2小时的订单&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;08-订单拆分&quot;&gt;08. 订单拆分&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/finSplitSttle&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 针对每个订单的拆分细则，拆分 护工工资、平台费、科室费、保险费、公司所得等费用&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;09-分账给护工站&quot;&gt;09. 分账给护工站&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/finInvoiceToStatn&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 针对每个订单的拆分细则，拆分 护工工资、平台费、科室费、保险费、公司所得等费用到具体的护工站&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;10-日结脚本&quot;&gt;10. 日结脚本&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/ordDayStt&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 针对每个订单做当日结算，消耗当天费用，并且拆分 护工工资、平台费、科室费、保险费、公司所得等费用
 2 每天12:30 23:30 跑该脚本&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;11-护工工资结算改变状态脚本&quot;&gt;11. 护工工资结算改变状态脚本&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/doSettleWrkfee&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 根据日结结果，计算每日护工工资
 2 每天1点15分 跑该脚本&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;12-订单逾期脚本&quot;&gt;12. 订单逾期脚本&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/ordFinishStt&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 结算到期订单用户未点击的订单 ，结算成逾期，并且释放床位
 2 每天1点30分 跑该脚本&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;13-订单结算状态脚本&quot;&gt;13. 订单结算状态脚本&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/doSttlement&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 对于用户已经点击结算，护工已经点击结束服务的订单，跑的脚本
 2 分钟跑该脚本&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name>kei gosling</name></author><summary type="html">01. 订单与结算逻辑.结算与支付</summary></entry><entry><title type="html">启东团队制</title><link href="https://thefirstwind.github.io//2020-10-03-%E5%90%AF%E4%B8%9C%E5%9B%A2%E9%98%9F%E5%88%B6/" rel="alternate" type="text/html" title="启东团队制" /><published>2020-10-03T00:00:00+08:00</published><updated>2020-10-03T00:00:00+08:00</updated><id>https://thefirstwind.github.io//%E5%90%AF%E4%B8%9C%E5%9B%A2%E9%98%9F%E5%88%B6</id><content type="html" xml:base="https://thefirstwind.github.io//2020-10-03-%E5%90%AF%E4%B8%9C%E5%9B%A2%E9%98%9F%E5%88%B6/">&lt;p&gt;启东团队制的设计&lt;/p&gt;

&lt;h3 id=&quot;业务数据-病区表-qmgrqm_hosp_pstn&quot;&gt;业务数据 病区表 qmgr.qm_hosp_pstn&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 修改条件：POS机代下单的时候，如果有优惠金额， discfg 和 discamount将发生变化
2 当有优惠的时候，影响的字段只有 discfg和 discamount
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| pstnid|Integer|必须| 病区ID |1|
| statncd|Integer|必须| 护工站ID | 31010700052|
| statnnm|String|必须| 护工站名称 | 上海市同济大学附属同济医院(同济医院) |
| building|String|必须| 楼信息 | 观留 |
| floor|String|必须| 层信息 | 1 |
| distrct|String|必须| 病区 | 五官科 |
| &lt;b&gt;usvctp1fg&lt;/b&gt;|String|必须| 一对一订单是否可以在用户端 自主下单 0 不可以 1可以| 1 （启东是0）|
| &lt;b&gt;usvctp2fg&lt;/b&gt;|String|必须| 一对多订单是否可以在用户端 自主下单 0 不可以 1可以| 1 （启东是0）|
| &lt;b&gt;usvctp3fg&lt;/b&gt;|String|必须| 用户端是否可以自主下团队制订单 0 不可以 1可以| 0 （启东是1）|
| &lt;b&gt;grpfg&lt;/b&gt;|String|必须| pos机 团队制标签 0 非团队制 1可以团队制| 0 启东是1）|
| &lt;b&gt;grpprice&lt;/b&gt;|String|必须| 团队制默认价格| 0 启东是500）|&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;12.images/screencapture-localhost-8888-chosemode-2018-09-12-13_22_44.png&quot; alt=&quot;screencapture-localhost-8888-chosemode-2018-09-12-13_22_44&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;12.images/screencapture-localhost-8888-chosemode-2018-09-12-17_01_29.png&quot; alt=&quot;screencapture-localhost-8888-chosemode-2018-09-12-17_01_29&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;12.images/screencapture-localhost-8888-chosemode-2018-09-12-17_02_11.png&quot; alt=&quot;screencapture-localhost-8888-chosemode-2018-09-12-17_02_11&quot; /&gt;&lt;/p&gt;</content><author><name>kei gosling</name></author><summary type="html">启东团队制的设计</summary></entry><entry><title type="html">订单与结算逻辑 订单变更</title><link href="https://thefirstwind.github.io//2020-10-03-%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E8%AE%A2%E5%8D%95%E5%8F%98%E6%9B%B4/" rel="alternate" type="text/html" title="订单与结算逻辑 订单变更" /><published>2020-10-03T00:00:00+08:00</published><updated>2020-10-03T00:00:00+08:00</updated><id>https://thefirstwind.github.io//%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E8%AE%A2%E5%8D%95%E5%8F%98%E6%9B%B4</id><content type="html" xml:base="https://thefirstwind.github.io//2020-10-03-%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E8%AE%A2%E5%8D%95%E5%8F%98%E6%9B%B4/">&lt;h1 id=&quot;03-订单与结算逻辑订单变更&quot;&gt;03. 订单与结算逻辑.订单变更&lt;/h1&gt;

&lt;blockquote&gt;

  &lt;ul&gt;
    &lt;li&gt;&lt;strong&gt;时间&lt;/strong&gt;：2018年9月7日&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;@[订单, 结算逻辑, 订单变更]&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;[TOC]&lt;/p&gt;

&lt;h2 id=&quot;订单变更业务范围&quot;&gt;订单变更业务范围&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;p&gt;1 订单类型： 服务中&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;2 适用场景：&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;更换护工&lt;/li&gt;
    &lt;li&gt;更换服务项目&lt;/li&gt;
    &lt;li&gt;更换床位&lt;/li&gt;
    &lt;li&gt;更换病区&lt;/li&gt;
    &lt;li&gt;修改服务天数&lt;/li&gt;
    &lt;li&gt;续单&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;3 注意事项：&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;由于无法明确 当产生护工变更的情况下 工资如何发放，因此订单变更&lt;/li&gt;
    &lt;li&gt;不产生支付的情况下，POS机变更 无须POS机管理端审核&lt;/li&gt;
    &lt;li&gt;当产生支付的情况下，POS机变更 需要管理老师审核，如果6个小时内不审核的话，订单变更将无效&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;数据字典&quot;&gt;数据字典&lt;/h2&gt;

&lt;h3 id=&quot;系统角色&quot;&gt;系统角色&lt;/h3&gt;
&lt;p&gt;| 端  |    用户群体 |    终端类型 | 终端名称  |
| :——– |:——–| :–: |:——–|
| 用户端  |患者、消费者 | 微信公众号 | E护通  |
| 护工端  |院内护工、居家护工 |  微信公众号  | E护通|护工  |
| 护士端  |提供上门服务的在册护士 | 微信公众号/APP  | 护通|专护 |
| POS机端 |擎浩医院管理老师| POS机  |  |
| PC端 |财务、运营、系统管理员等| PC电脑端 |   |
| 统计端|院方高层、护理界高层| 微信公众号  | 擎浩护理  |&lt;/p&gt;

&lt;h3 id=&quot;订单状态&quot;&gt;订单状态&lt;/h3&gt;
&lt;p&gt;| 状态  | 状态名称 |  说明|
| :——– |:——–| :– |
| 0  | 无状态 | 空状态，冗余字段 |
| 1  | 预约中 | 院外抢单用状态 |
| 2  | 预约成功 | POS机管理老师代接单，并且派工之后的状态 |
| 3  | 待支付（在2小时内付款，超时被取消） | 院内订单下单之后的状态 |
| 4  | 已支付（支付成功） | 支付成功的状态 |
| 5  | 待服务（等待上门服务，计时） | 支付成功之后，2个小时之内保持待服务状态 |
| 6  | 服务中（服务进度） | 支付成功之后，2个小时之后进入服务中状态 |
| 7  | 待结算 | 用户(POS机)发起结算 （等待结算并提示用户结算，超时关闭订单）|
| 8  | 已完成 | 用户(POS机)发起结算之后，如果判断退款成功，状态变为完成 |
| 9  | 待评价 | 冗余状态 |
| 10  | 已评价 | 用户评价完成之后 |
| 11  | 已取消（取消成功） | 超时支付，自动变为取消|
| 12  | 申请退款（发起退款申请） | 待服务状态，申请全额退款的状态 |
| 13  | 退款中（退款已受理，并进行退款程序） | 发起退款的状态 |
| 14  | 退款成功 （退款额转入用户账户） | 用户(POS机)发起退款，如果确认退款成功，状态变为退款成功 |
| 15  | 退款失败（提示失败原因） | 用户(POS机)发起退款，如果确认退款失败，状态变为退款失败 |
| 16  | 变更待服务 | 发起订单变更之后的状态 |
| 17  | 结算中 | 用户(POS机)发起结算，状态变为结算中 |
| 18  | 结算完成 | 用户(POS机)发起结算，如果确认结算成功，状态变为结算完成 |
| 19  | 结算失败 | 用户(POS机)发起结算，如果确认结算失败，状态变为结算失败 |&lt;/p&gt;

&lt;h2 id=&quot;数据库设计&quot;&gt;数据库设计&lt;/h2&gt;
&lt;h3 id=&quot;订单变更表&quot;&gt;订单变更表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：服务中的订单，发生变化的情况
2 修改条件：POS机管理端管理老师审核之后aplfg会变化、过期不审核aplfg也会变化
3 终止条件：审核通过
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| id|Integer|必须| 订单变更ID|1|
| orduid|String|必须| 订单号|ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| neworduid|String|必须| 新订单号&lt;br /&gt;当有支付时，生成新订单号|ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| orgfg|Integer|必须| 原订单标志 1原始订单记录 2修改后的订单记录| 1|
| chgwrkfg|Integer|| 是否更换护工 0 不换人 1 换人| 1|
| wuid|String|必须| 护工UID| WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh|
| svctp|String|必须| 交易号| TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| startday|date|必须| 服务开始时间 默认当前日期| 2018-04-05|
| svcday|Integer|必须| 服务天数| 10|
| unitprice|Integer|必须|  服务项目单价| 9000|
| amount|Integer|必须| 服务项目小计 服务项目单价 X 服务天数（精算）| 90000|
| statncd|String|必须|服务网点 订单服务网点（非网点，没有代码） |31010700052 |
| statnnm|String|必须| 服务医院 医院名称| 上海市同济大学附属同济医院(同济医院)|
| sitmid|Integer|必须| 服务价格ID| 835|
| needpayfg|Integer|必须| 是否需要支付| 1|
| ordlessfee|Integer|必须| 订单剩余价格| 90000|
| continufee|Integer|必须| 结转金额| 10000|
| payfee|Integer|必须| 支付金额| 80000|
| aplfg|Integer|必须| 申请状态 0 申请中 1 批准 2 驳回（过期）| 1|&lt;/p&gt;

&lt;h3 id=&quot;订单主表&quot;&gt;订单主表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：用户下单、POS机下单、发生支付的订单变更
2 修改条件：支付、超时未支付、补录患者信息、订单变更、订单结算（用户或者POS发起的结算）、其他影响状态变化的节点
3 终止条件：超时未支付、订单完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| orduid|String|必须| 订单号|ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| ordid|String|必须| 订单ID|1804050053004W|
| uopid|String|必须| 患者openid| ooDqLwHXcSIFoMZxTX3DtHkLtaOM|
| tradeno|String|必须| 支付UID| TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| ptorduid|String|必须| 患者姓名| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| rlnm|String|必须| 父订单号，续单用，初始值为其本身如果有续单或者纠纷负单则为其父单orduid| 王根娣|
| startday|date|必须| 服务开始时间 默认当前日期| 2018-04-05|
| svcday|Integer|必须| 服务天数| 10|
| statncd|String|必须| 护工站代码| 31010700052|
| statnnm|String|必须| 护工站| 上海市同济大学附属同济医院(同济医院)|
| amount|Integer|必须| 订单初始预收金额| 90000|
| ordlessfee|Integer|| 订单剩余金额| 0|
| status1|Integer|| 0 无状态  &lt;br /&gt;1 预约中 &lt;br /&gt;2 预约成功 &lt;br /&gt;3 待支付（在2小时内付款，超时被取消） &lt;br /&gt;4 已支付（支付成功）&lt;br /&gt;5 待服务（等待上门服务，计时）&lt;br /&gt;6 服务中（服务进度）&lt;br /&gt;7 待结算（等待结算并提示用户结算，超时关闭订单）&lt;br /&gt;8 已完成 &lt;br /&gt;9 待评价 &lt;br /&gt;10 已评价&lt;br /&gt; 11 已取消（取消成功） &lt;br /&gt;12 申请退款（发起退款申请） &lt;br /&gt;13 退款中（退款已受理，并进行退款程序） &lt;br /&gt;14 退款成功 （退款额转入用户账户） &lt;br /&gt;15 退款失败（提示失败原因） &lt;br /&gt;16 变更待服务 &lt;br /&gt;17 结算中 &lt;br /&gt;18 结算完成 &lt;br /&gt;19结算失败 &lt;br /&gt;| 5|
| status1nm|String|| 同上| 待服务|
| usrconftm|datetime||用户确认完成时间| 2018-04-14 14:54:50|
| splitsttlfg|Integer|| 拆分结算标识0：未拆分结算，1已拆分结算| 0|
| continufee|Integer|| 结转金额| 0|
| chgstatus|Integer||  1 变更未开始 &lt;br /&gt;2 变更已开始&lt;br /&gt;| 0|
| sttlefg|Integer|| 结算标识：给用户退款订单结算掉，成功结算更新 0默认,1已结算| 0|&lt;/p&gt;

&lt;h3 id=&quot;订单详情表&quot;&gt;订单详情表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：用户下单、POS机下单、不发生支付的订单变更
2 修改条件：订单变更、订单结算（用户或POS发起的订单结算）、护工结束服务、其他影响状态变化的节点
3 终止条件：超时未支付、订单完成
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| orduid|String|必须| 订单号|ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| wuid|String|必须| 护工Uid| WK_bRyaLdFbHDI9VjxUhSar1BLFEHOSh|
| wstatncd|String|必须| 所属网点 该护工所属网点|31010700052 |
| statncd|String|必须|服务网点 订单服务网点（非网点，没有代码） |31010700052 |
| hospnm|String|必须| 服务医院 医院名称| 上海市同济大学附属同济医院(同济医院)|
| sitmid|Integer|必须| 服务项目 当ordtp属于院内时| |
| svctp|String|必须| 交易号| TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| startday|date|必须| 服务开始时间 默认当前日期| 2018-04-05|
| svcday|Integer|必须| 服务天数| 10|
| unitprice|Integer|必须|  服务项目单价| 9000|
| amount|Integer|必须| 服务项目小计 服务项目单价 X 服务天数（精算）| 90000|
| adjustday|decimal(4,2)|| 调整天数 -0.5 0  0.5 三个值，在最后一天结算| 0|
| status1|Integer|| 0 无状态&lt;br /&gt;1 预约中 &lt;br /&gt;2 预约成功&lt;br /&gt;3 待支付（在15分钟内付款，超时被取消） &lt;br /&gt;4 已支付（支付成功）.&lt;br /&gt;5 待服务（等待上门服务，计时）&lt;br /&gt;6 服务中（服务进度）&lt;br /&gt;7 待结算（等待结算并提示用户结算，超时关闭订单）&lt;br /&gt;8 已完成&lt;br /&gt;9 待评价 &lt;br /&gt;10 已评价&lt;br /&gt;11 已取消（取消成功） &lt;br /&gt;12 申请退款（发起退款申请） &lt;br /&gt;13 退款中（退款已受理，并进行退款程序） &lt;br /&gt;14 退款成功 （退款额转入用户账户） &lt;br /&gt;15 退款失败（提示失败原因）&lt;br /&gt;16 变更待服务&lt;br /&gt;17 结算中 &lt;br /&gt;18 结算完成 &lt;br /&gt;19结算失败 | 5|
| status1nm|String||同上 | 待服务|
| status3|Integer|| 状态-完成 0 无状态 1 完成 | 1|
| status3nm|String|| 状态-完成-说明 保存护工的做工状态 | 完成|
| factsvcfg|Integer|| 子单实际服务标识：0 是默认，1 是结算退款记录， 2 是退款记录{tips:该子单是否是实际服务单} | 0|&lt;/p&gt;

&lt;h3 id=&quot;支付信息表&quot;&gt;支付信息表&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 插入条件：支付、退款、结算等，有金额流转的情况
2 修改条件：支付成功后状态 paid状态更新，结算申请发起、结算状态更新、退款状态发起、退款状态更新。
3 终止条件：超时未支付、支付完成、结算完成、退款完成、
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| tradeno|String|必须| 支付订单号 tr+”-“+36位UUID（带-）&lt;br /&gt;微信线上支付 pt开头&lt;br /&gt;微信扫码支付 td开头&lt;br /&gt;银联支付 tr开头|TDU_Kn2yCIWlcOYD7V4KmcWfW76Ngynl|
| orduid|String|必须| 订单UID 订单主表ID| ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| subid|Integer|必须| 订单Subid, 子单号|1|
| uopid|String|| 用户UID 支付者UID，不一定是被服务的患者|ooDqLwHXcSIFoMZxTX3DtHkLtaOM|
| fopid|String|| 推荐者UID 推荐者UID||
| ttype|Integer|| 订单类型 1医院 2医院单项 3居家|1|
| paid|Integer|| 是否已支付 &lt;br /&gt;0 未支付 &lt;br /&gt;1 线上支付 &lt;br /&gt;2 现金支付&lt;br /&gt;3 退款成功&lt;br /&gt;4 退款失败|1|
| paidtm|datetime|| 支付时间 非0的时候 才有值|2018-04-05 10:58:56|
| payment|Integer|| 支付方式 &lt;br /&gt;1 微信 &lt;br /&gt;2 刷卡（借记卡） &lt;br /&gt;3 刷卡（信用卡） &lt;br /&gt;4 现金（线下支付）&lt;br /&gt; 5 支付宝|1|
| amount|Integer|| 支付金额|90000|
| outorderno|String|| 外部订单号 外部订单号||
| outtransno|String|| 外部流水号 外部流水号|4200000095201804052560224795|
| resttlfg|Integer|| 预结算标志位：0未结算，1已结算||
| sttlfg|Integer|| 已结算标志 0未结算 1 已结算||
| sttlamt|Integer|| 结算金额||
| invoicetm|datetime|| 预分账标志位||
| reinvfg|Integer|| 分账标志||
| invoicefg|Integer|| ||
| refund|Integer|| 退款标志 现阶段价格统一。&lt;br /&gt;该字段为空，当每个省价格不同时，会用到。&lt;br /&gt;0是付款 1是退款|0|
| cardNo|String|| 银联支付用字段: 支付时所用的卡号(该字段当银联支付退款时使用)||
| transChnName|String|| 支付渠道名称||
| transEngName|String|| 支付渠道||
| refNo|String|| 银联支付用参考号||
| merchantNo|String|| 根据支付时的，商户编号||
| terminalNo|String|| pos机终端号码||
| traceNo|String|| 银联商务支付的记录号(每一个pos机从1开始计数)||&lt;/p&gt;

&lt;h2 id=&quot;订单变更的流程&quot;&gt;订单变更的流程&lt;/h2&gt;
&lt;h3 id=&quot;用户端发起订单变更无需支付&quot;&gt;用户端发起订单变更(无需支付):&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-sequence&quot;&gt;用户端-&amp;gt;[数据库]: 1 患者发起订单变更
用户端-&amp;gt;[数据库]: 2 变更订单（无支付）
POS机-&amp;gt;[数据库]: 确认变更申请
POS机-&amp;gt;[数据库]: 变更审核
[批处理]-&amp;gt;[批处理]: 是否超过6小时没有审核
[批处理]-&amp;gt;[数据库]: 超过6小时没有审核，变更自动作废
[批处理]-&amp;gt;[数据库]: 退款
[批处理]-&amp;gt;[批处理]: 新开始服务时间 &amp;lt; 当前时间
[批处理]-&amp;gt;[数据库]: 旧订单(服务中)、新订单(变更待服务)
[批处理]-&amp;gt;[批处理]: 新开始服务时间 &amp;gt;= 当前时间
[批处理]-&amp;gt;[数据库]: 旧订单(已完成)、新订单(服务中)
[批处理]--&amp;gt;用户端: 通知用户服务已开始
[批处理]--&amp;gt;护工端: 通知旧护工服务已结束
[批处理]--&amp;gt;护工端: 通知新护工服务已开始
[数据库]--&amp;gt;用户端: 查看订单信息
[数据库]-&amp;gt;PC端: 查看订单信息
[数据库]-&amp;gt;护工端: 查看订单信息
护工端--&amp;gt;用户端: 推送服务日志
用户端-&amp;gt;[数据库]: 发起结算
[批处理]--&amp;gt;[批处理]: 发起结算、向银行请求数据、进入结算中状态
[批处理]--&amp;gt;[批处理]: 判断结算申请的结果、
[批处理]--&amp;gt;[数据库]: 结算成功/结算失败 -&amp;gt; 更新状态
[数据库]-&amp;gt;[数据库]: 服务结束时间判断
用户端--&amp;gt;护工端: 订单结算
护工端--&amp;gt;[数据库]: 服务结束
POS机--&amp;gt;用户端: 订单强制结算
POS机--&amp;gt;护工端: 订单强制结算
用户端-&amp;gt;[数据库]:用户评价、状态进入已评价状态
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;用户端发起订单变更需支付&quot;&gt;用户端发起订单变更(需支付):&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-sequence&quot;&gt;用户端-&amp;gt;[数据库]: 1 患者发起订单变更
用户端-&amp;gt;[数据库]: 2 变更订单（需要支付）
用户端--&amp;gt;[数据库]: 3 支付
POS机-&amp;gt;[数据库]: 确认变更申请
POS机--&amp;gt;[数据库]: 支付
POS机-&amp;gt;[数据库]: 变更审核
[批处理]-&amp;gt;[批处理]: 是否超过6小时没有审核
[批处理]-&amp;gt;[数据库]: 超过6小时没有审核，变更自动作废
[批处理]-&amp;gt;[数据库]: 退款
[批处理]-&amp;gt;[批处理]: 新开始服务时间 &amp;lt; 当前时间
[批处理]-&amp;gt;[数据库]: 旧订单(服务中)、新订单(变更待服务)
[批处理]-&amp;gt;[批处理]: 新开始服务时间 &amp;gt;= 当前时间
[批处理]-&amp;gt;[数据库]: 旧订单(已完成)、新订单(服务中)
[批处理]--&amp;gt;用户端: 通知用户服务已开始
[批处理]--&amp;gt;护工端: 通知旧护工服务已结束
[批处理]--&amp;gt;护工端: 通知新护工服务已开始
[数据库]--&amp;gt;用户端: 查看订单信息
[数据库]-&amp;gt;PC端: 查看订单信息
[数据库]-&amp;gt;护工端: 查看订单信息
护工端--&amp;gt;用户端: 推送服务日志
用户端-&amp;gt;[数据库]: 发起结算
[批处理]--&amp;gt;[批处理]: 发起结算、向银行请求数据、进入结算中状态
[批处理]--&amp;gt;[批处理]: 判断结算申请的结果、
[批处理]--&amp;gt;[数据库]: 结算成功/结算失败 -&amp;gt; 更新状态
[数据库]-&amp;gt;[数据库]: 服务结束时间判断
用户端--&amp;gt;护工端: 订单结算
护工端--&amp;gt;[数据库]: 服务结束
POS机--&amp;gt;用户端: 订单强制结算
POS机--&amp;gt;护工端: 订单强制结算
用户端-&amp;gt;[数据库]:用户评价、状态进入已评价状态
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;pos机发起订单变更无需支付&quot;&gt;POS机发起订单变更(无需支付):&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-sequence&quot;&gt;POS机-&amp;gt;[数据库]: POS机发起订单变更
POS机-&amp;gt;[数据库]: 变更订单（无支付）
POS机-&amp;gt;[数据库]: 确认变更申请
POS机-&amp;gt;[数据库]: 变更直接生效
[批处理]-&amp;gt;[批处理]: 新开始服务时间 &amp;lt; 当前时间
[批处理]-&amp;gt;[数据库]: 旧订单(服务中)、新订单(变更待服务)
[批处理]-&amp;gt;[批处理]: 新开始服务时间 &amp;gt;= 当前时间
[批处理]-&amp;gt;[数据库]: 旧订单(已完成)、新订单(服务中)
[批处理]--&amp;gt;用户端: 通知用户服务已开始
[批处理]--&amp;gt;护工端: 通知旧护工服务已结束
[批处理]--&amp;gt;护工端: 通知新护工服务已开始
[数据库]--&amp;gt;用户端: 查看订单信息
[数据库]-&amp;gt;PC端: 查看订单信息
[数据库]-&amp;gt;护工端: 查看订单信息
护工端--&amp;gt;用户端: 推送服务日志
用户端-&amp;gt;[数据库]: 发起结算
[批处理]--&amp;gt;[批处理]: 发起结算、向银行请求数据、进入结算中状态
[批处理]--&amp;gt;[批处理]: 判断结算申请的结果、
[批处理]--&amp;gt;[数据库]: 结算成功/结算失败 -&amp;gt; 更新状态
[数据库]-&amp;gt;[数据库]: 服务结束时间判断
用户端--&amp;gt;护工端: 订单结算
护工端--&amp;gt;[数据库]: 服务结束
POS机--&amp;gt;用户端: 订单强制结算
POS机--&amp;gt;护工端: 订单强制结算
用户端-&amp;gt;[数据库]:用户评价、状态进入已评价状态
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;用户端发起订单变更需支付-1&quot;&gt;用户端发起订单变更(需支付):&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-sequence&quot;&gt;POS机-&amp;gt;[数据库]: 患者发起订单变更
POS机-&amp;gt;[数据库]: 变更订单（需要支付）
POS机--&amp;gt;[数据库]: 支付
POS机-&amp;gt;[数据库]: 确认变更申请
POS机-&amp;gt;[数据库]: 变更审核
[批处理]-&amp;gt;[批处理]: 是否超过6小时没有审核
[批处理]-&amp;gt;[数据库]: 超过6小时没有审核，变更自动作废
[批处理]-&amp;gt;[数据库]: 退款
[批处理]-&amp;gt;[批处理]: 新开始服务时间 &amp;lt; 当前时间
[批处理]-&amp;gt;[数据库]: 旧订单(服务中)、新订单(变更待服务)
[批处理]-&amp;gt;[批处理]: 新开始服务时间 &amp;gt;= 当前时间
[批处理]-&amp;gt;[数据库]: 旧订单(已完成)、新订单(服务中)
[批处理]--&amp;gt;用户端: 通知用户服务已开始
[批处理]--&amp;gt;护工端: 通知旧护工服务已结束
[批处理]--&amp;gt;护工端: 通知新护工服务已开始
[数据库]--&amp;gt;用户端: 查看订单信息
[数据库]-&amp;gt;PC端: 查看订单信息
[数据库]-&amp;gt;护工端: 查看订单信息
护工端--&amp;gt;用户端: 推送服务日志
用户端-&amp;gt;[数据库]: 发起结算
[批处理]--&amp;gt;[批处理]: 发起结算、向银行请求数据、进入结算中状态
[批处理]--&amp;gt;[批处理]: 判断结算申请的结果、
[批处理]--&amp;gt;[数据库]: 结算成功/结算失败 -&amp;gt; 更新状态
[数据库]-&amp;gt;[数据库]: 服务结束时间判断
用户端--&amp;gt;护工端: 订单结算
护工端--&amp;gt;[数据库]: 服务结束
POS机--&amp;gt;用户端: 订单强制结算
POS机--&amp;gt;护工端: 订单强制结算
用户端-&amp;gt;[数据库]:用户评价、状态进入已评价状态
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;后台批处理接口说明&quot;&gt;后台批处理接口说明&lt;/h2&gt;

&lt;h3 id=&quot;01-审核超时的退款处理&quot;&gt;01. 审核超时的退款处理&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/cancelUnaplyToUnPayOrd&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 清理6小时内审核未通过的订单
 2 如果有的话，直接退款&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;02-修改变更服务变成待服务立即执行-没有支付的订单变更&quot;&gt;02. 修改变更服务变成待服务(立即执行) 没有支付的订单变更&lt;/h3&gt;
&lt;p&gt;只有审批通过的变更待服务才能进入服务状态，否者6个小时后回恢复、并且退款&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderChangeSerStart&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 到了变更后的开始时间，
 2 老订单完结，新订单进入开始服务状态&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;03-变更订单的等待状态变成开始服务-有支付状态的订单变更&quot;&gt;03. 变更订单的等待状态变成开始服务 有支付状态的订单变更&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8081/api/schd/orderChangeWaitSerToSer&lt;/a&gt;
    &lt;blockquote&gt;
      &lt;p&gt;说明：
 1 到了变更后的开始时间，
 2 老订单完结，新订单进入开始服务状态&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name>kei gosling</name></author><summary type="html">03. 订单与结算逻辑.订单变更</summary></entry><entry><title type="html">订单与结算逻辑 订单</title><link href="https://thefirstwind.github.io//2020-10-03-%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E8%AE%A2%E5%8D%95/" rel="alternate" type="text/html" title="订单与结算逻辑 订单" /><published>2020-10-03T00:00:00+08:00</published><updated>2020-10-03T00:00:00+08:00</updated><id>https://thefirstwind.github.io//%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E8%AE%A2%E5%8D%95</id><content type="html" xml:base="https://thefirstwind.github.io//2020-10-03-%E8%AE%A2%E5%8D%95%E4%B8%8E%E7%BB%93%E7%AE%97%E9%80%BB%E8%BE%91-%E8%AE%A2%E5%8D%95/">&lt;h1 id=&quot;01-订单与结算逻辑订单&quot;&gt;01. 订单与结算逻辑.订单&lt;/h1&gt;

&lt;blockquote&gt;

  &lt;ul&gt;
    &lt;li&gt;&lt;strong&gt;时间&lt;/strong&gt;：2018年8月9日
@[订单, 支付方式, 结算逻辑]&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;[TOC]&lt;/p&gt;

&lt;h2 id=&quot;数据字典&quot;&gt;数据字典&lt;/h2&gt;

&lt;h3 id=&quot;系统角色&quot;&gt;系统角色&lt;/h3&gt;
&lt;p&gt;| 端  |    用户群体 |    终端类型 | 终端名称  |
| :——– |:——–| :–: |:——–|
| 用户端  |患者、消费者 | 微信公众号 | E护通  |
| 护工端  |院内护工、居家护工 |  微信公众号  | E护通|护工  |
| 护士端  |提供上门服务的在册护士 | 微信公众号/APP  | 护通|专护 |
| POS机端 |擎浩医院管理老师| POS机  |  |
| PC端 |财务、运营、系统管理员等| PC电脑端 |   |
| 统计端|院方高层、护理界高层| 微信公众号  | 擎浩护理  |&lt;/p&gt;

&lt;h3 id=&quot;院内订单类型&quot;&gt;院内订单类型&lt;/h3&gt;
&lt;p&gt;| 订单类型  | 前提条件 |  工资计算说明| 
| :——– |:——–| :–: |
| 1对1订单 | 院内有机动护工 | 系统计算、每日按照比例分配 |
| 1对多订单 | 当前病区绑定了护工 |  系统计算、每日按照比例分配   | 
| 团队制订单| 当前病区支持团队制 | 不统计报表  | 
| 单项订单 |擎浩医院管理老师| 待定 |&lt;/p&gt;

&lt;h2 id=&quot;下单相关流程&quot;&gt;下单相关流程&lt;/h2&gt;
&lt;h3 id=&quot;用户下单时序图&quot;&gt;用户下单(时序图):&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&quot;language-plantuml&quot;&gt;@startuml
用户端 -&amp;gt; POS机: 下单
用户端 -&amp;gt; POS机: [￥支付 微信 ]
用户端 --&amp;gt; 系统: 更新数据
系统 --&amp;gt; POS机: 推送消息
POS机 -&amp;gt; 系统: 评估、补录患者信息
POS机 -&amp;gt; 系统: [￥收款：微信/支付宝/银行卡/现金]
系统 --&amp;gt; 用户端: 查看订单信息
系统 -&amp;gt; PC端: 查看订单信息
系统 -&amp;gt; 护工端: 查看订单信息
系统 -&amp;gt; 系统: 服务开始时间判断
系统 -&amp;gt; 系统: 服务中
护工端 --&amp;gt; 用户端: 推送服务日志
系统 -&amp;gt; 系统: 服务结束时间判断
用户端 --&amp;gt; 护工端: 订单结算
护工端 --&amp;gt; 系统: 服务结算
POS机 --&amp;gt; 用户端: 订单强制结算
POS机 --&amp;gt; 护工端: 订单强制结算
@enduml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;###用户下单(流程图):&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-flow&quot;&gt;st=&amp;gt;start: 开始
e=&amp;gt;end: 结束
e2=&amp;gt;end: 结束
op1=&amp;gt;operation: 填写患者信息
sub1=&amp;gt;subroutine: 选择1对1护工
sub2=&amp;gt;subroutine: 选择1对多护工
cond1=&amp;gt;condition: 选择下单方式（1对1）
cond2=&amp;gt;condition: 选择下单方式（1对多）
sub3=&amp;gt;subroutine: 微信、支付宝、银行卡、现金
cond3=&amp;gt;condition: 在线微信支付
op4=&amp;gt;operation: POS机收款
op5=&amp;gt;operation: POS机收款成功
op6=&amp;gt;operation: 支付成功


st-&amp;gt;op1-&amp;gt;cond1
cond1(no)-&amp;gt;cond2
cond1(yes)-&amp;gt;sub1-&amp;gt;cond3
cond2(yes)-&amp;gt;sub2-&amp;gt;cond3
cond2(no)-&amp;gt;e2
cond3(no,left)-&amp;gt;op4-&amp;gt;sub3-&amp;gt;op5-&amp;gt;e
cond3(yes)-&amp;gt;op6-&amp;gt;e2

&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;pos机代下单时序图&quot;&gt;POS机代下单(时序图):&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-plantuml&quot;&gt;@startuml
POS机 -&amp;gt; 系统 : 填写用户信息、下单
POS机 -&amp;gt; 系统: [￥收款：微信/支付宝/银行卡/现金]
系统 --&amp;gt; 用户手机: 推送短信
PC端 -&amp;gt; 系统: 查看订单信息
护工端 -&amp;gt; 系统: 查看订单信息
系统 -&amp;gt; 系统: 服务开始时间判断
系统-&amp;gt; 系统: 服务中
系统-&amp;gt; 系统: 服务结束时间判断
护工端 --&amp;gt; 系统: 服务结算
POS机 --&amp;gt; 用户手机: 订单强制结算、推送短信
POS机 --&amp;gt; 护工端: 订单强制结算
@enduml
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;pos机代下单流程图&quot;&gt;POS机代下单(流程图):&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-flow&quot;&gt;st=&amp;gt;start: 开始
e=&amp;gt;end: 结束
e2=&amp;gt;end: 结束
op1=&amp;gt;operation: 填写患者信息
sub1=&amp;gt;subroutine: 选择1对1护工
sub2=&amp;gt;subroutine: 选择1对多护工
cond1=&amp;gt;condition: 选择下单方式（1对1）
cond2=&amp;gt;condition: 选择下单方式（1对多）
sub3=&amp;gt;subroutine: 微信、支付宝、银行卡、现金
cond3=&amp;gt;condition: 在线微信支付
op4=&amp;gt;operation: POS机收款
op5=&amp;gt;operation: POS机收款成功
op6=&amp;gt;operation: 支付成功


st-&amp;gt;op1-&amp;gt;cond1
cond1(no)-&amp;gt;cond2
cond1(yes)-&amp;gt;sub1-&amp;gt;cond3
cond2(yes)-&amp;gt;sub2-&amp;gt;cond3
cond2(no)-&amp;gt;e2
cond3(no,left)-&amp;gt;op4-&amp;gt;sub3-&amp;gt;op5-&amp;gt;e
cond3(yes)-&amp;gt;op6-&amp;gt;e2

&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;下单接口文档&quot;&gt;下单接口文档&lt;/h2&gt;

&lt;h3 id=&quot;1-用户端下单接口说明&quot;&gt;1. 用户端下单接口说明&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;请求URL&lt;/strong&gt;
    &lt;blockquote&gt;
      &lt;p&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8881/api/order/create&lt;/a&gt;&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;请求方式&lt;/strong&gt;
    &lt;blockquote&gt;
      &lt;p&gt;&lt;strong&gt;POST&lt;/strong&gt;&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;请求参数&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;请求参数&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数类型&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;必须&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数说明&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参考值&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;uopid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;用户Uopid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;odkVKsyBVCiPkzsiJtmCaaAPs6Xc&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ordtp&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;订单类型&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;svctp&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;服务类型：1 一对一 / 2 一对多 / 3 团队制&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;svcday&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;服务天数&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;uphone&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;患者手机号码&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;18616579337&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;startday&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Date&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;服务开始时间&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2018-08-13&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;pstnid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;病区ID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;581&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;bed&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;床位号&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;33&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sitmid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;价格ID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;297&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;svctp2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;服务类型2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;nightcare&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Boolean&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;夜陪标志&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;true&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;age&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;年龄&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;76&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;disease&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;疾病标签&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;rlnm&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;患者真实姓名&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;患者姓名&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sex&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;性别：0 女 1男&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工UID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;WK_cSjgwj5nIhdzJ_kfd83oNnH6I8yBZ&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;返回参数&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;返回参数&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数类型&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数说明&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参考值&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;success&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;boolean&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;请求成功与否&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;code&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;执行结果code&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;message&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;执行结果&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;执行成功&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;orduid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;订单号码&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ORD_48dj2B3vU1NkPOQjYpveN6YPOo05&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;返回示例&lt;/strong&gt;
    &lt;blockquote&gt;

      &lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;success&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;code&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;操作正确&quot;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;orduid&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ORD_48dj2B3vU1NkPOQjYpveN6YPOo05&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;      &lt;/div&gt;
      &lt;h3 id=&quot;2-pos机代下单接口文档&quot;&gt;2. POS机代下单接口文档&lt;/h3&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;请求URL&lt;/strong&gt;
    &lt;blockquote&gt;
      &lt;p&gt;&lt;a href=&quot;#&quot;&gt;http://localhost:8883/api/posorder/replace&lt;/a&gt;&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;请求方式&lt;/strong&gt;
    &lt;blockquote&gt;
      &lt;p&gt;&lt;strong&gt;POST&lt;/strong&gt;&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;请求参数&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;请求参数&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数类型&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;必须&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数说明&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参考值&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wstatncd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;所在护工站CD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;31010900053&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;svctp&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;服务类型：1 一对一 / 2 一对多 / 3 团队制&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;svcday&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;服务天数&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;uphone&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;患者手机&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;18616579337&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;startday&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Date&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;服务开始时间&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2018-08-13&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;pstnid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;病区ID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;581&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;bed&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;床位号&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;age&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;必须&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;年龄&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;76&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;disease&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;疾病标签&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;rlnm&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;患者真实姓名&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;患者姓名&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sex&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;性别：0 女 1男&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wuid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;护工UID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;WK_cSjgwj5nIhdzJ_kfd83oNnH6I8yBZ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;uoipd&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;用户uopid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;null&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sitmid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;价格ID&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;297&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;grpamount&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;团队制订单价格&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;null&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;返回参数&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;返回参数&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数类型&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参数说明&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;参考值&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;success&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;boolean&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;请求成功与否&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;code&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;执行结果code&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;message&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;执行结果消息&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;orduid&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;String&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;执行结果消息&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ORD_X7IS7TYobMXybv9hfEqPFoavsrQw&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;返回示例&lt;/strong&gt;
    &lt;blockquote&gt;

      &lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;success&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;code&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;操作正确&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;orduid&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ORD_X7IS7TYobMXybv9hfEqPFoavsrQw&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;      &lt;/div&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name>kei gosling</name></author><summary type="html">01. 订单与结算逻辑.订单</summary></entry><entry><title type="html">订单减免</title><link href="https://thefirstwind.github.io//2020-10-03-%E8%AE%A2%E5%8D%95%E5%87%8F%E5%85%8D/" rel="alternate" type="text/html" title="订单减免" /><published>2020-10-03T00:00:00+08:00</published><updated>2020-10-03T00:00:00+08:00</updated><id>https://thefirstwind.github.io//%E8%AE%A2%E5%8D%95%E5%87%8F%E5%85%8D</id><content type="html" xml:base="https://thefirstwind.github.io//2020-10-03-%E8%AE%A2%E5%8D%95%E5%87%8F%E5%85%8D/">&lt;p&gt;qo_ord&lt;/p&gt;

&lt;p&gt;订单减免相关业务的设计&lt;/p&gt;

&lt;h3 id=&quot;订单主表--qordqo_ord&quot;&gt;订单主表  qord.qo_ord&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
1 修改条件：POS机代下单的时候，如果有优惠金额， discfg 和 discamount将发生变化
2 当有优惠的时候，影响的字段只有 discfg和 discamount
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| orduid|String|必须| 订单号|ORD_i7E_eQjRrXGKbYPscFqg7iOlsgK7|
| amount|Integer|必须| 订单初始预收金额| 90000|
| discfg|String|必须| 优惠标识discfg：0:无优惠，1：全免，2:减免医院管理费，3：减免公司收入，4：减免增收,5:团队制减免| 1，2，3，4 |
| discamount|Integer|必须| 优惠金额| 100 |&lt;/p&gt;

&lt;h3 id=&quot;订单价格表-qordqo_statn_item&quot;&gt;订单价格表 qord.qo_statn_item&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明： 无
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 字段名      |     参数类型 | 必须 | 参数说明   | 参考值|
| :——– | :——–|:——–| :—— |:—— |
| stimid|Integer|必须| 价格ID|332|
| statncd|String|必须| 护工站代码| 31010700052|
| statnnm|String|必须| 护工站名称| 同济医院(上海市同济大学附属同济医院)|
| price|String|必须| 价格| 10000|
| companyfee|String|必须| 平台费用| 500|
| plusfee|String|必须| 增收| 500|
| hospfee|String|必须| 医院管理费| 500|
| deptfee|Integer|必须| 科室费| 500|
| wrkfee|Integer|必须| 护工费| 8000|&lt;/p&gt;

&lt;h3 id=&quot;数据字典各个case相关的数据变化&quot;&gt;数据字典，各个case相关的数据变化&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;说明：
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;| 优惠类型|   服务价格|  qo_ord.amount | 优惠类型&lt;br /&gt; qo_ord.discfg  | 优惠金额 &lt;br /&gt; qo_ord.discamount| 支付金额&lt;br /&gt; qo_pay_trade.amount|
| :——– | :——–|:——–| :—— |:—— |:—— |
| 0: 无优惠 |700元| 70000 |0|0|70000|
| 1: 全免 |700元|70000| 1,2,3,4| 10000|80000|
| 2: 减免医院管理费|700元|70000| 2| 30000 |40000|
| 3: 减免公司收入、4：减免增收|700元|70000| 3,4| 20000 |50000|
| 5: 团队制减免 |1700元|170000| 5| 10000 |160000|&lt;/p&gt;</content><author><name>kei gosling</name></author><summary type="html">qo_ord</summary></entry><entry><title type="html">Exclude Post from Search Index</title><link href="https://thefirstwind.github.io//jekyll/2017-11-28-post-exclude-search/" rel="alternate" type="text/html" title="Exclude Post from Search Index" /><published>2017-11-28T00:00:00+08:00</published><updated>2018-02-19T21:06:00+08:00</updated><id>https://thefirstwind.github.io//jekyll/post-exclude-search</id><content type="html" xml:base="https://thefirstwind.github.io//jekyll/2017-11-28-post-exclude-search/">&lt;p&gt;This post should not appear in the search index because it has the following YAML Front Matter:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;search&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;false&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p class=&quot;notice--info&quot;&gt;&lt;strong&gt;Note:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;search: false&lt;/code&gt; only works to exclude posts when using Lunr as a search provider.&lt;/p&gt;

&lt;p&gt;To exclude files when using Algolia as a search provider add an array to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;algolia.files_to_exclude&lt;/code&gt; in your &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_config.yml&lt;/code&gt;. For more configuration options be sure to check their &lt;a href=&quot;https://community.algolia.com/jekyll-algolia/options.html&quot;&gt;full documentation&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;algolia&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# Exclude more files from indexing&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;files_to_exclude&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;index.html&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;index.md&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;excluded-file.html&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;_posts/2017-11-28-post-exclude-search.md&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;subdirectory/*.html&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>kei gosling</name></author><category term="Jekyll" /><summary type="html">This post should not appear in the search index because it has the following YAML Front Matter:</summary></entry><entry><title type="html">Layout: Header Video</title><link href="https://thefirstwind.github.io//layout/uncategorized/2017-01-23-layout-header-video/" rel="alternate" type="text/html" title="Layout: Header Video" /><published>2017-01-23T00:00:00+08:00</published><updated>2017-01-23T00:00:00+08:00</updated><id>https://thefirstwind.github.io//layout/uncategorized/layout-header-video</id><content type="html" xml:base="https://thefirstwind.github.io//layout/uncategorized/2017-01-23-layout-header-video/">&lt;p&gt;This post should display a &lt;strong&gt;header with a responsive video&lt;/strong&gt;, if the theme supports it.&lt;/p&gt;

&lt;h2 id=&quot;settings&quot;&gt;Settings&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Parameter&lt;/th&gt;
      &lt;th&gt;Required&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;id&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;Required&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;ID of the video&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;provider&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;Required&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;Hosting provider of the video, either &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;youtube&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vimeo&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;youtube&quot;&gt;YouTube&lt;/h3&gt;

&lt;p&gt;To embed the following YouTube video at url &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://www.youtube.com/watch?v=XsxDH4HcOWA&lt;/code&gt; (long version) or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://youtu.be/XsxDH4HcOWA&lt;/code&gt; (short version) into a post or page’s main content you’d use:&lt;/p&gt;

&lt;div class=&quot;language-liquid highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;video&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;XsxDH4HcOWA&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;provider&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;youtube&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;%}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!-- Courtesy of embedresponsively.com //--&gt;

&lt;div class=&quot;responsive-video-container&quot;&gt;
    &lt;iframe src=&quot;https://www.youtube-nocookie.com/embed/XsxDH4HcOWA&quot; frameborder=&quot;0&quot; webkitallowfullscreen=&quot;&quot; mozallowfullscreen=&quot;&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;
  &lt;/div&gt;

&lt;p&gt;To embed it as a video header you’d use the following YAML Front Matter&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;video&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;XsxDH4HcOWA&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;provider&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;youtube&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;vimeo&quot;&gt;Vimeo&lt;/h3&gt;

&lt;p&gt;To embed the following Vimeo video at url &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://vimeo.com/212731897&lt;/code&gt; into a post or page’s main content you’d use:&lt;/p&gt;

&lt;div class=&quot;language-liquid highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;video&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;212731897&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;provider&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;vimeo&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;%}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!-- Courtesy of embedresponsively.com //--&gt;

&lt;div class=&quot;responsive-video-container&quot;&gt;
    &lt;iframe src=&quot;https://player.vimeo.com/video/212731897?dnt=true&quot; frameborder=&quot;0&quot; webkitallowfullscreen=&quot;&quot; mozallowfullscreen=&quot;&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;
  &lt;/div&gt;

&lt;p&gt;To embed it as a video header you’d use the following YAML Front Matter&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;video&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;212731897&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;provider&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;vimeo&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>kei gosling</name></author><category term="Layout" /><category term="Uncategorized" /><category term="video" /><category term="layout" /><summary type="html">This post should display a header with a responsive video, if the theme supports it.</summary></entry></feed>